<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>37.2° Blog | 37.2° Blog</title><meta name="author" content="Dongnian"><meta name="copyright" content="Dongnian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="2.三次握手、四次挥手 - wolai 笔记TCP协议是一个安全的、面向连接的、流式传输协议，所谓的面向连接就是三次握手，对于程序猿来说只需要在客户端调用connect()函数，三次握手就自动进行了。先通过下图看一下TCP协议的格式，然后再介绍三次握手的具体流程。1.TCP协议介绍在Tcp协议中，比较重要的字段有：源端口：表示发送端端口号，字段长 16 位，2个字节目的端口：表示接收端端口号，字">
<meta property="og:type" content="website">
<meta property="og:title" content="37.2° Blog">
<meta property="og:url" content="https://wdndev.github.io/note/linux/socket/2.%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E3%80%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/2.%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E3%80%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.html">
<meta property="og:site_name" content="37.2° Blog">
<meta property="og:description" content="2.三次握手、四次挥手 - wolai 笔记TCP协议是一个安全的、面向连接的、流式传输协议，所谓的面向连接就是三次握手，对于程序猿来说只需要在客户端调用connect()函数，三次握手就自动进行了。先通过下图看一下TCP协议的格式，然后再介绍三次握手的具体流程。1.TCP协议介绍在Tcp协议中，比较重要的字段有：源端口：表示发送端端口号，字段长 16 位，2个字节目的端口：表示接收端端口号，字">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wdndev.github.io/img/wdn_icon.png">
<meta property="article:published_time" content="2024-12-08T03:56:27.870Z">
<meta property="article:modified_time" content="2024-12-08T03:56:27.870Z">
<meta property="article:author" content="Dongnian">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wdndev.github.io/img/wdn_icon.png"><link rel="shortcut icon" href="/img/wdn_icon.png"><link rel="canonical" href="https://wdndev.github.io/note/linux/socket/2.%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E3%80%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/2.%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E3%80%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":100,"languages":{"author":"Author: Dongnian","link":"Link: ","source":"Source: 37.2° Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '37.2° Blog',
  isPost: false,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-08 11:56:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/wdn_icon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">87</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Content</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/paper_reading/pr_content"><i class="fa-fw fas fa-newspaper"></i><span> Paper</span></a></li><li><a class="site-page child" href="/llms/llms_idx"><i class="fa-fw fa-solid fa-magnifying-glass"></i><span> LLMs</span></a></li><li><a class="site-page child" href="/jupyter"><i class="fa-fw fa-solid fa-file"></i><span> Jupyter</span></a></li><li><a class="site-page child" href="/note"><i class="fa-fw fa-regular fa-bookmark"></i><span> Note</span></a></li><li><a class="site-page child" href="/dsa/dsa_idx"><i class="fa-fw fas fa-tree"></i><span> Algorithm</span></a></li><li><a class="site-page child" href="/program_language/pl_idx"><i class="fa-fw fas fa-code"></i><span> PLs</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="37.2° Blog"><span class="site-name">37.2° Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Content</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/paper_reading/pr_content"><i class="fa-fw fas fa-newspaper"></i><span> Paper</span></a></li><li><a class="site-page child" href="/llms/llms_idx"><i class="fa-fw fa-solid fa-magnifying-glass"></i><span> LLMs</span></a></li><li><a class="site-page child" href="/jupyter"><i class="fa-fw fa-solid fa-file"></i><span> Jupyter</span></a></li><li><a class="site-page child" href="/note"><i class="fa-fw fa-regular fa-bookmark"></i><span> Note</span></a></li><li><a class="site-page child" href="/dsa/dsa_idx"><i class="fa-fw fas fa-tree"></i><span> Algorithm</span></a></li><li><a class="site-page child" href="/program_language/pl_idx"><i class="fa-fw fas fa-code"></i><span> PLs</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="page"><h1 class="page-title"></h1><div id="article-container"><!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../css/wolai.css"/><title>2.三次握手、四次挥手 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="2.三次握手、四次挥手" class="main-title"></div></div></header><article><div id="3KUxoDX9GgMu1LzpxgdV7o" class="wolai-block wolai-text"><div><span class="inline-wrap">TCP<span class="jill"></span>协议是一个安全的、面向连接的、流式传输协议，所谓的面向连接就是三次握手，对于程序猿来说只需要在客户端调用</span><span class="inline-wrap"><code>connect()</code></span><span class="inline-wrap">函数，三次握手就自动进行了。先通过下图看一下<span class="jill"></span>TCP<span class="jill"></span>协议的格式，然后再介绍三次握手的具体流程。</span></div></div><h1 id="dE2MbyXLghC9FXbRKk8Cuo" class="wolai-block"><span class="inline-wrap">1.TCP<span class="jill"></span>协议介绍</span></h1><div id="tVQWa31m4RLWBo6ToC8p4A" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image.png" style="width: 100%"/></figure></div><div id="F5x7Xy39d23sVjppsV5iy" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Tcp<span class="jill"></span>协议中，比较重要的字段有：</span></div></div><ul class="wolai-block"><li id="7xXpcF7ryDj7GpTnJerKVL"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="yellow inline-wrap"><b>源端口</b></span><span class="inline-wrap">：表示发送端端口号，字段长 16 位，2<span class="jill"></span>个字节</span></li><li id="fZRLcMsmfYoYxWKy4akdS8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="yellow inline-wrap"><b>目的端口</b></span><span class="inline-wrap">：表示接收端端口号，字段长 16 位，2<span class="jill"></span>个字节</span></li><li id="iFGvG5wX5mPFu2TpU43maB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="yellow inline-wrap"><b>序号（sequence number）</b></span><span class="inline-wrap">：字段长 32 位，占<span class="jill"></span>4<span class="jill"></span>个字节，序号的范围为 </span><span class="inline-wrap"><code>[0,4284967296]</code></span><span class="inline-wrap">。</span><ul class="wolai-block"><li id="vjH12bPJfcG9U8WYoteK5H"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">由于<span class="jill"></span>TCP<span class="jill"></span>是面向字节流的，在一个<span class="jill"></span>TCP<span class="jill"></span>连接中传送的字节流中的每一个字节都按顺序编号
</span></li><li id="4cB3AzKg6QL2LDZsgmynnQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">首部中的序号字段则是指本报文段所发送的数据的第一个字节的序号，这是随机生成的。
</span></li><li id="aCAWbJMf14VeeGa34c9ktv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">序号是循环使用的，当序号增加到最大值时，下一个序号就又回到了<span class="jill"></span>0
</span></li></ul></li><li id="utmGtdY8JgvG1gakrVpUNR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="yellow inline-wrap"><b>确认序号（acknowledgement number）</b></span><span class="inline-wrap">：占<span class="jill"></span>32<span class="jill"></span>位（4<span class="jill"></span>字节），表示收到的下一个报文段的第一个数据字节的序号，如果确认序号为<span class="jill"></span>N，序号为<span class="jill"></span>S，则表明到序号<span class="jill"></span>N-S<span class="jill"></span>为止的所有数据字节都已经被正确地接收到了。</span></li><li id="7WGU9nZrEWajpv2SdLAjqR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="yellow inline-wrap"><b>8<span class="jill"></span>个标志位（Flag）</b></span><span class="inline-wrap">:</span><ul class="wolai-block"><li id="fp5YyTQs6zxsg8Urt9L2a2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>CWR</b></span><span class="inline-wrap">：CWR 标志与后面的 ECE 标志都用于 IP 首部的 ECN 字段，ECE 标志为 1 时，则通知对方已将拥塞窗口缩小；</span></li><li id="xi661W5ZspigKVtneFdi5a"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>ECE</b></span><span class="inline-wrap">：若其值为 1 则会通知对方，从对方到这边的网络有阻塞。在收到数据包的 IP 首部中 ECN 为 1 时将 TCP 首部中的 ECE 设为 1.；</span></li><li id="wVBAD7GQ848LLTi5qdXhoe"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>URG</b></span><span class="inline-wrap">：该位设为 1，表示包中有需要紧急处理的数据，对于需要紧急处理的数据，与后面的紧急指针有关；</span></li><li id="eXbxnRcG3YP7cHPDapcYAx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>ACK</b></span><span class="red inline-wrap">：该位设为 1，确认应答的字段有效，TCP<span class="jill"></span>规定除了最初建立连接时的 SYN 包之外该位必须设为 1；</span></li><li id="7FoJJwcZGw1a8XHBx43aE4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">PSH：该位设为 1，表示需要将收到的数据立刻传给上层应用协议，若设为 0，则先将数据进行缓存；
</span></li><li id="kmKmcT9tNh6NjTxkHtjSUj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">RST：该位设为 1，表示 TCP 连接出现异常必须强制断开连接；
</span></li><li id="4SL49WMo9yYtdBbV8E2MSs"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>SYN</b></span><span class="red inline-wrap">：用于建立连接，该位设为 1，表示希望建立连接，并在其序列号的字段进行序列号初值设定；</span></li><li id="7p7DbyHhasMYmNcPPjjKme"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>FIN</b></span><span class="red inline-wrap">：该位设为 1，表示今后不再有数据发送，希望断开连接。</span></li></ul></li><li id="nSDvDe7vzwuHuUFAYTuTH3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="yellow inline-wrap"><b>窗口大小</b></span><span class="inline-wrap">：该字段长 16 位，表示从确认序号所指位置开始能够接收的数据大小，TCP 不允许发送超过该窗口大小的数据。</span></li></ul><h1 id="8ocryETJuHfLNWD6LkH12K" class="wolai-block"><span class="inline-wrap">2.三次握手</span></h1><div id="en2dBvuDQtZEg4Ra7SweQG" class="wolai-block wolai-text"><div><span class="inline-wrap">Tcp<span class="jill"></span>连接是双向连接，客户端和服务器需要分别向对方发送连接请求，并且建立连接，三次握手成功之后，二者之间的双向连接也就成功建立了。如果要保证三次握手顺利完成，必须要满足以下条件：</span></div></div><ul class="wolai-block"><li id="doh68bpxZUqPzB26W52o5m"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>服务器端</b></span><span class="inline-wrap">：已经启动，并且启动了监听（被动接受连接的一端）</span></li><li id="3XMhgLDwHUN13yAc2ZH55C"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>客户端</b></span><span class="inline-wrap">：基于服务器端监听的<span class="jill"></span>IP<span class="jill"></span>和端口，向服务器端发起连接请求（主动发起连接的一端）</span></li></ul><div id="mY1h9rAx9hqHhccpxHGWPY" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_1.png" style="width: 100%"/></figure></div><div id="tBuwRQP4pCbHwPj67jQfcc" class="wolai-block wolai-text"><div><span class="inline-wrap">三次握手具体过程如下：</span></div></div><h3 id="oaGkVpA8eQSrFJMwGZJDwm" class="wolai-block"><span class="inline-wrap">（1）第一次握手</span></h3><ul class="wolai-block"><li id="u74qPerJU9RvJm31MWQqM3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>客户端</b></span><span class="inline-wrap">：客户端向服务器端发起连接请求将报文中的<span class="jill"></span>SYN<span class="jill"></span>字段置为<span class="jill"></span>1，生成随机序号<span class="jill"></span>x，seq=x</span></li><li id="k9toaC5u7KLeR5rH7C1j87"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>服务器端</b></span><span class="inline-wrap">：接收客户端发送的请求数据，解析<span class="jill"></span>tcp<span class="jill"></span>协议，校验<span class="jill"></span>SYN<span class="jill"></span>标志位是否为<span class="jill"></span>1，并得到序号 x</span></li></ul><h3 id="wKPoqVHEuivuCY2PfSTXGv" class="wolai-block"><span class="inline-wrap">（2）第二次握手</span></h3><div id="3r7ZxMkCwwDpVAyXYdYRpV" class="wolai-block wolai-text"><div><span class="yellow inline-wrap"><b>服务器端：给客户端回复数据</b></span></div></div><ol class="wolai-block"><li id="wk7btY15JtZ2GWYYB7hdJ9"><div class="marker"></div><span class="inline-wrap">回复<span class="jill"></span>ACK, 将<span class="jill"></span>tcp<span class="jill"></span>协议<span class="jill"></span>ACK<span class="jill"></span>对应的标志位设置为<span class="jill"></span>1，表示同意了客户端建立连接的请求
</span></li><li id="e91a5R5PbyfWZ4MMQLTkfD"><div class="marker"></div><span class="inline-wrap">回复了 </span><span class="inline-wrap"><code>ack=x+1</code></span><span class="inline-wrap">, 这是确认序号</span><ul class="wolai-block"><li id="ckYWFw8t5JdTxepXJpHW78"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">x： 客户端生成的随机序号</span></li><li id="8tgEhCEVCKavizRr7oroui"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">1： 客户端给服务器发送的数据的量, SYN<span class="jill"></span>标志位存储到某一个字节中, 因此按照一个字节计算，表示客户端给服务器发送的<span class="jill"></span>1<span class="jill"></span>个字节服务器收到了。</span></li></ul></li><li id="9Qo9XWkYnkQXwyVaZUq9Gs"><div class="marker"></div><span class="inline-wrap">将<span class="jill"></span>tcp<span class="jill"></span>协议中的<span class="jill"></span>SYN<span class="jill"></span>对应的标志位设置为 1, 服务器向客户端发起了连接请求
</span></li><li id="jLQpsJUiH19kG6D3WWWiza"><div class="marker"></div><span class="inline-wrap">服务器端生成了一个随机序号 y, 发送给了客户端</span></li></ol><div id="d9BmRYUswa78SEaZWYto7R" class="wolai-block wolai-text"><div><span class="yellow inline-wrap"><b>客户端：接收回复的数据，并解析<span class="jill"></span>tcp<span class="jill"></span>协议</b></span></div></div><ol class="wolai-block"><li id="6YRnKmtmQexEhG7rsu5FfE"><div class="marker"></div><span class="inline-wrap">校验<span class="jill"></span>ACK<span class="jill"></span>标志位，为<span class="jill"></span>1<span class="jill"></span>表示服务器接收了客户端的连接请求</span></li><li id="gXAQfVx4xCmrD3k5mZuE4X"><div class="marker"></div><span class="inline-wrap">数据校验，确认发送给服务器的数据服务器收到了没有，计算公式如下：</span><div id="n2oquKR5fJ5XoizXbfwFQy" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>发送的数据的量 = 使用服务器回复的确认序号 - 客户端生成的随机序号</code></span><span class="inline-wrap"> ===&gt; </span><span class="inline-wrap"><code>1=x+1-x</code></span></div></div></li><li id="sbuWXCp5CbMTCjMgoJcXyZ"><div class="marker"></div><span class="inline-wrap">校验<span class="jill"></span>SYN<span class="jill"></span>标志位，为<span class="jill"></span>1<span class="jill"></span>表示服务器请求和客户端建立连接</span></li><li id="du38e35HTReZZAvCyxgTXW"><div class="marker"></div><span class="inline-wrap">得到服务器生成的随机序号: y</span></li></ol><h3 id="aU2ioHBiTkyi1e8E16y83e" class="wolai-block"><span class="inline-wrap">（3）第三次握手：</span></h3><div id="kwsjYhFDqSBcRktQRbWD7h" class="wolai-block wolai-text"><div><span class="yellow inline-wrap"><b>客户端：发送数据给服务器</b></span></div></div><ol class="wolai-block"><li id="8D1aiSGr9w3vpzJbZX8wdc"><div class="marker"></div><span class="inline-wrap">将<span class="jill"></span>tcp<span class="jill"></span>协议中<span class="jill"></span>ACK<span class="jill"></span>标志位设置为<span class="jill"></span>1，表示同意了服务器的连接请求
</span></li><li id="vErcQpfbZUmQabkw9H4DnF"><div class="marker"></div><span class="inline-wrap">给服务器回复了一个确认序号 ack = y+1</span><ul class="wolai-block"><li id="3GdymjRSR3PCLfUM2KtaP4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">y：服务器端生成的随机序号
</span></li><li id="9Li7dRbHsoiXsTBNzGNN5C"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">1：服务器给客户端发送的数据量，服务器给客户端发送了<span class="jill"></span>ACK<span class="jill"></span>和<span class="jill"></span>SYN, 都存储在这一个字节中</span></li></ul></li><li id="hkseVEjs2UP7XTG75eo8U2"><div class="marker"></div><span class="inline-wrap">发送给服务器的序号就是上一次从服务器端收的确认序号因此 seq = x+1</span></li></ol><div id="sjUM42emxMah827MUvTrpH" class="wolai-block wolai-text"><div><span class="yellow inline-wrap"><b>服务器端：接收数据, 并解析<span class="jill"></span>tcp<span class="jill"></span>协议</b></span></div></div><ol class="wolai-block"><li id="ePnKKpiGU3C6sHC97Febqn"><div class="marker"></div><span class="inline-wrap">查看<span class="jill"></span>ACK<span class="jill"></span>对应的标志位是否为<span class="jill"></span>1, 如果是<span class="jill"></span>1<span class="jill"></span>代表, 客户端同意了服务器的连接请求</span></li><li id="pvrSaDcdsxf63R8k2szygF"><div class="marker"></div><span class="inline-wrap">数据校验，确认发送给客户端的数据客户端收到了没有，计算公式如下：</span><div id="kdFzRpABSt8aA74hJHTdFf" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>给客户端发送的数据量 = 确认序号 - 服务器生成的随机序号</code></span><span class="inline-wrap"> ===&gt; </span><span class="inline-wrap"><code>1=y+1-y</code></span></div></div></li><li id="G5kHzTumNPo2ys5GKcPAj"><div class="marker"></div><span class="inline-wrap">得到客户端发送的序号：x+1</span></li></ol><div id="jFSDTjUSBjAm3L1eFwPz7s" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_2.png" style="width: 639px"/></figure></div><h1 id="gS9a1bkUNEg2YMXQ4ZPjMW" class="wolai-block"><span class="inline-wrap">3.四次挥手</span></h1><div id="qNwxGzYVji9xafw95S1zcT" class="wolai-block wolai-text"><div><span class="inline-wrap">四次挥手是断开连接的过程，需要双向断开，关于由哪一端先断开连接是没有要求的。通信的两端如果想要断开连接就需要调用</span><span class="inline-wrap"><code>close()</code></span><span class="inline-wrap">函数，当两端都调用了该函数，四次挥手也就完成了。</span></div></div><ul class="wolai-block"><li id="41fjP1GY5NsDegtrRfqEEi"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">客户端和服务器断开连接 -&gt; 单向断开</span></li><li id="tmMEC2AcZ8Y6v8mzUqXA9w"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">服务器和客户端断开连接 -&gt; 单向断开</span></li></ul><div id="9ZzF185G4BoD47iDfJrcb8" class="wolai-block wolai-text"><div><span class="inline-wrap">进行了两次单向断开，双向断开就完成了，每进行一次单向断开，就会完成两次挥手的动作。</span></div></div><div id="vvQ6bjz9nbs8sjChZSJY9u" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_3.png" style="width: 100%"/></figure></div><div id="7JgUXtzRz6uQuL1sQDuCew" class="wolai-block wolai-text"><div><span class="inline-wrap">基于上图的例子对四次挥手的具体过程进行阐述（</span><span class="red inline-wrap">实际上那端先断开连接都是允许的</span><span class="inline-wrap">）：</span></div></div><h3 id="3TpLzAP311g3UwLzsu2C8Y" class="wolai-block"><span class="inline-wrap">（1）第一次挥手</span></h3><div id="aqEVPSqoSP2XZ58nwv2ccy" class="wolai-block wolai-text"><div><span class="yellow inline-wrap">主动断开连接的一方：发送断开连接的请求</span></div></div><ol class="wolai-block"><li id="3KxX2ta4gMzjZQAbB6V2a6"><div class="marker"></div><span class="inline-wrap">将<span class="jill"></span>tcp<span class="jill"></span>协议中<span class="jill"></span>FIN<span class="jill"></span>标志位设置为<span class="jill"></span>1，表示请求断开连接
</span></li><li id="mVzjxWNmfYtpsM2Cb7HGie"><div class="marker"></div><span class="inline-wrap">发送序号<span class="jill"></span>x<span class="jill"></span>给对端，seq=x，基于这个序号用于客户端数据校验的计算</span></li></ol><div id="k4E9V9Un5ERZKhWPoGgN8C" class="wolai-block wolai-text"><div><span class="yellow inline-wrap">被动断开连接的一方：接收请求数据, 并解析<span class="jill"></span>TCP<span class="jill"></span>协议</span></div></div><ol class="wolai-block"><li id="sRmNtVQ2KuGTwDwQ9wRtda"><div class="marker"></div><span class="inline-wrap">校验<span class="jill"></span>FIN<span class="jill"></span>标志位是否为<span class="jill"></span>1
</span></li><li id="bBuus4TTXCTXfaGtKGkfnP"><div class="marker"></div><span class="inline-wrap">收到了序号 x，基于这个数据计算回复的确认序号 ack 的值</span></li></ol><h3 id="ejABhzjp9J1qq17yCGKXnA" class="wolai-block"><span class="inline-wrap">（2）第二次挥手</span></h3><div id="2DP44NDLUDoST1Mx3fYP8n" class="wolai-block wolai-text"><div><span class="yellow inline-wrap">被动断开连接的一方：回复数据</span></div></div><ol class="wolai-block"><li id="wQc7aH5sREYAgFJQ7YYNT1"><div class="marker"></div><span class="inline-wrap">同意了对方断开连接的请求，将<span class="jill"></span>ACK<span class="jill"></span>标志位设置为<span class="jill"></span>1
</span></li><li id="fgPGqmRRboVZ1fMnYA12PF"><div class="marker"></div><span class="inline-wrap">回复 ack=x+1，表示成功接受了客户端发送的一个字节数据
</span></li><li id="7MD4B7nii9rHKmnpcK6w1h"><div class="marker"></div><span class="inline-wrap">向客户端发送序号 seq=y，基于这个序号用于服务器端数据校验的计算</span></li></ol><div id="jGTAbrG4P4vT1LaLCrPMEJ" class="wolai-block wolai-text"><div><span class="yellow inline-wrap">主动断开连接的一方：接收回复数据, 并解析<span class="jill"></span>TCP<span class="jill"></span>协议</span></div></div><ol class="wolai-block"><li id="vYB8o6HogNzZh7SNYSWJ8"><div class="marker"></div><span class="inline-wrap">校验<span class="jill"></span>ACK<span class="jill"></span>标志位，如果为<span class="jill"></span>1<span class="jill"></span>表示断开连接的请求对方已经同意了
</span></li><li id="tWz9xEYHJ18QGumt3GZya1"><div class="marker"></div><span class="inline-wrap">校验 ack<span class="jill"></span>确认发送的数据服务器是否收到了，发送的数据 = ack - x = x + 1 -x = 1</span></li></ol><h3 id="rMZ2FHypBi6Zuun44PjEde" class="wolai-block"><span class="inline-wrap">（3）第三次挥手</span></h3><div id="qTaciKnMbNAkC5Nndqh31t" class="wolai-block wolai-text"><div><span class="yellow inline-wrap">被动断开连接的一方</span><span class="inline-wrap">：将<span class="jill"></span>tcp<span class="jill"></span>协议中<span class="jill"></span>FIN<span class="jill"></span>标志位设置为<span class="jill"></span>1，表示请求断开连接
</span></div></div><div id="tp3P3hnKXQtTVMLLCWJaQp" class="wolai-block wolai-text"><div><span class="yellow inline-wrap">主动断开连接的一方</span><span class="inline-wrap">：接收请求数据, 并解析<span class="jill"></span>TCP<span class="jill"></span>协议，校验<span class="jill"></span>FIN<span class="jill"></span>标志位是否为<span class="jill"></span>1</span></div></div><h3 id="qtCVpnkVFw6LqFGaWXSSsJ" class="wolai-block"><span class="inline-wrap">（4）第四次挥手</span></h3><div id="7apRUpsqGiEqwE3b2Ndep4" class="wolai-block wolai-text"><div><span class="yellow inline-wrap">主动断开连接的一方：回复数据</span></div></div><ol class="wolai-block"><li id="6MAimyvY3vhU9qDAxn6zSp"><div class="marker"></div><span class="inline-wrap">将<span class="jill"></span>tcp<span class="jill"></span>协议中<span class="jill"></span>ACK<span class="jill"></span>对应的标志位设置为<span class="jill"></span>1，表示同意了断开连接的请求
</span></li><li id="pPCwVDFQmpdDkuCUkGjeRe"><div class="marker"></div><span class="inline-wrap">ack=y+1，表示服务器发送给客户端的一个字节客户端接收到了
</span></li><li id="dnULjfGqGkWKdHDGXHfoAm"><div class="marker"></div><span class="inline-wrap">序号 seq=h，此时的<span class="jill"></span>h<span class="jill"></span>应该等于 x+1，也就是第三次挥手时服务器回复的确认序号<span class="jill"></span>ack<span class="jill"></span>的值</span></li></ol><div id="237DU7hVhqd2KDMmKJA2ej" class="wolai-block wolai-text"><div><span class="yellow inline-wrap">被动断开连接的一方</span><span class="inline-wrap">：收到回复的<span class="jill"></span>ACK, 此时双向连接双向断开, 通信的两端没有任何关系了</span></div></div><h1 id="x37MonjXpArJgpwNiXdNM6" class="wolai-block"><span class="inline-wrap">4.流量控制</span></h1><div id="kMHqRh8sCFaryXT6zkYuhu" class="wolai-block wolai-text"><div><span class="inline-wrap">流量控制可以让发送端根据接收端的实际接受能力控制发送的数据量。它的具体操作是，</span><span class="yellow inline-wrap"><b>接收端主机向发送端主机通知自己可以接收数据的大小，于是发送端会发送不会超过该大小的数据，该限制大小即为窗口大小，即窗口大小由接收端主机决定。</b></span></div></div><div id="oV1MvZRF9RKerGBtkydgs4" class="wolai-block wolai-text"><div><span class="inline-wrap">TCP 首部中，专门有一个字段来通知窗口大小，接收主机将自己可以接收的缓冲区大小放在该字段中通知发送端。</span><span class="yellow inline-wrap"><b>当接收端的缓冲区面临数据溢出时，窗口大小的值也是随之改变，设置为一个更小的值通知发送端，从而控制数据的发送量，这样达到流量的控制</b></span><span class="inline-wrap">。这个控制流程的窗口也可以称作滑动窗口。</span></div></div><div id="tLykmroZup9Mu7PrMVZiKg" class="wolai-block wolai-text"><div><span class="inline-wrap">这个图是一个单向的数据发送:</span></div></div><div id="bC3pexdWcBfjzJPoGFttTT" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_4.png" style="width: 100%"/></figure></div><div id="rU3Q3P9JAKf24EhsV954G8" class="wolai-block wolai-text"><div><span class="inline-wrap">左侧是数据发送端：对应的是发送端的写缓冲区(内存)，通过一个环形队列进行数据管理</span></div></div><ul class="wolai-block"><li id="3G44USdWnjqfQsSXjDzBY5"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">白色格子: 空闲的内存, 可以写数据
</span></li><li id="usfFf1TxsTYjMrNsw6XttD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">粉色的格子: 被写入到内存, 但是还没有被发送出去的数据
</span></li><li id="5Dr2GfYCkBZhQGmZCTAvp5"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">灰色的格子: 代表已经被发送出去的数据</span></li></ul><div id="abKd1NqvZPMBYeSAAwbc6N" class="wolai-block wolai-text"><div><span class="inline-wrap">右侧是数据接收端：对应的是接收端的读缓冲区，存储发送端发送过来的数据</span></div></div><ul class="wolai-block"><li id="o7E2WfPyGyK2o4dtFd9aoG"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">白色格子：空闲的内存, 可以继续接收数据, 滑动窗口的值记录的就是白色的格子的大小
</span><ul class="wolai-block"><li id="5H8yjZBo14onyaaYcu5LVh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">随着接收的数据越来越多, 白色格子越来越少, 滑动窗口的值越来越小
</span></li><li id="judma6GRXWyCgv4CPHzvnp"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果白色格子没有了, 滑动窗口变为<span class="jill"></span>0, 这时候, 发送端就被阻塞了
</span></li></ul></li><li id="oCstvoCjr99s8jLZvkAMUZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">粉色格子：接收的数据，但是这个数据还没有从内核中读走，使用<span class="jill"></span>read() / recv()
</span><ul class="wolai-block"><li id="2m5vdbEzf6KJU6KovEzqc1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">粉色格子变少了, 可用空间就变多了, 滑动窗口的值就变大了
</span></li><li id="qm5f36jDmQmBuCuLARYdtD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果滑动窗口的值从<span class="jill"></span>0<span class="jill"></span>变为大于<span class="jill"></span>0, 接收端又重新有容量接收数据了, 发送端的阻塞自动解除，继续发送数据</span></li></ul></li></ul><h1 id="5tPkFyCt41SqBHaBAR1HdN" class="wolai-block"><span class="inline-wrap">5.整体流程</span></h1><div id="mwcjCxQbG2ZVDWkoHor2Ut" class="wolai-block wolai-text"><div><span class="inline-wrap">基于<span class="jill"></span>TCP<span class="jill"></span>通信的流程图，记录了从三次握手 -&gt; 数据通信 -&gt; 四次挥手是全过程：</span></div></div><div id="xakAim3g7Gj8x1Th63PgsB" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="media/image_5.png" style="width: 431px"/></figure></div><code-block id="kCADfLwGHGMCSnLjbtPyqZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># fast sender: 客户端</span>
<span class="token comment"># slow recerver: 服务器</span>
<span class="token comment"># win: 滑动窗口大小</span>
<span class="token comment"># mss: maximum segment size, 单条数据的最大长度</span></pre></div></code-block><h4 id="6Am9iLpDh6hNLA2YSp7sQi" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>1<span class="jill"></span>步：第一次握手，发送连接请求<span class="jill"></span>SYN<span class="jill"></span>到服务器端</span></h4><ul class="wolai-block"><li id="eFp7YRtezum976QnZ4aeWN"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>0(0)</code></span><span class="inline-wrap">：0<span class="jill"></span>表示客户端生成的随机序号，(0)表示客户端没有额外给服务器发送数据, 因此数据的量为<span class="jill"></span>0</span></li><li id="r3XczLPb3fs8BVRDrN4tvr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>win4096</code></span><span class="inline-wrap">: 客户端告诉服务器, 能接收的数据(缓存)的最大量为<span class="jill"></span>4k</span></li><li id="9k5k6iGtKQJWQkLZP9Vkr7"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>mss1460</code></span><span class="inline-wrap">: 客户端可以处理的单条最大字节数是<span class="jill"></span>1460<span class="jill"></span>字节</span></li></ul><h4 id="ab8sGLTkLuTU3ABS5rUeZf" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>2<span class="jill"></span>步：第二次握手</span></h4><ul class="wolai-block"><li id="8mutWyZDPmCmhbmBjW2wc2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ACK</code></span><span class="inline-wrap">: 服务器同意了客户端的连接请求
</span></li><li id="kEZp3D57g6LqHCQN1Fn7K3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>SYN</code></span><span class="inline-wrap">: 服务器请求和客户端建立连接</span></li><li id="eetKNTKP2ZuDUdKggoTjHj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>8000(0)</code></span><span class="inline-wrap">：8000<span class="jill"></span>是服务器端生成的随机序号，(0)表示服务器没有额外给客户端发送数据, 因此数据的量为<span class="jill"></span>0
</span></li><li id="dKNLn3sbqNhq9pGzmZqhmW"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>1</code></span><span class="inline-wrap">: 发送给客户端的确认序号
确认序号 = 客户端生成的随机序号 + 客户端给服务器发送的数据量(字节数) ===&gt; 1=0+1
表示客户端给服务器发送的<span class="jill"></span>1<span class="jill"></span>个字节服务器收到了
</span></li><li id="rMSRxb7SNGD1ME57U1t4rj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>win6144</code></span><span class="inline-wrap">: 服务器告诉客户端我能最多缓存 6k<span class="jill"></span>数据</span></li><li id="utBdhzFJuHtnzEzSwyX3rz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>mss1024</code></span><span class="inline-wrap">: 服务器能处理的单条数据最大长度是 1k</span></li></ul><h4 id="pE6ez4LFLVJbbKPpxYduwa" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>3<span class="jill"></span>步: 第三次握手</span></h4><ul class="wolai-block"><li id="buC1zmbBRUt13hjB529fBu"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ACK:</code></span><span class="inline-wrap"> 客户端同意了服务器的连接请求</span></li><li id="x1sXxjhpuftefzJcQjnozU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>8001</code></span><span class="inline-wrap">: 发送给服务器的确认序号
确认序号 = 服务器生成的随机序号 + 服务器给客户端发送的数据量 ===&gt; 8001 = 8000 + 1
客户端告诉服务器, 你给我发送的<span class="jill"></span>1<span class="jill"></span>个字节的数据我收到了</span></li><li id="daomQEpQBHSRrvYp2Yp14u"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>win4096</code></span><span class="inline-wrap">: 告诉服务器客户端能缓存的最大数据量是<span class="jill"></span>4k</span></li></ul><h4 id="j4H1Egbweagt3S6QL4HhDF" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>4~9<span class="jill"></span>步: 客户端给服务器发送数据</span></h4><ul class="wolai-block"><li id="53f1GdwDGMs6oMonDHDDr9"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>1(1024)</code></span><span class="inline-wrap">：1 （1-0）表示之前一共给服务器发送了<span class="jill"></span>1<span class="jill"></span>个字节，(1024)表示这次要发送的数据量为 1k
</span></li><li id="gSkSgybcQPdn6GS8iPkgYv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>1025(1024)</code></span><span class="inline-wrap">：1025（1025-0）表示之前一共给服务器发送了<span class="jill"></span>1025<span class="jill"></span>个字节，(1024)表示这次要发送的数据量为 1k</span></li><li id="s8SoFAC7HdNQQ5ehfL1Sgc"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>2049(1024)</code></span><span class="inline-wrap">：2049（2049-0）表示之前一共给服务器发送了<span class="jill"></span>2049<span class="jill"></span>个字节，(1024)表示这次要发送的数据量为 1k</span></li><li id="eef34aZicxv2rksAprPmhD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">第<span class="jill"></span>9<span class="jill"></span>步完成之后，服务器的滑动窗口变为<span class="jill"></span>0，接收数据的缓存被写满了，发送端阻塞</span></li></ul><h4 id="rdAjhZiYi5sWpDTTzfp8Wv" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>10<span class="jill"></span>步:</span></h4><ul class="wolai-block"><li id="og8sK584d9mZoGj68gWQpH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ack6145</code></span><span class="inline-wrap">: 服务器给客户端回复数据，6145<span class="jill"></span>是确认序号, 代表实际接收的字节数
服务器实际接收的字节数 = 确认序号 - 客户端生成的随机序号 ===&gt; 6145 = 6145 - 0</span></li><li id="3U3iWD4C9d3fCiZ9rSLPZ4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>win2048</code></span><span class="inline-wrap">：服务器告诉客户端我的缓存还有<span class="jill"></span>2k，也就是还有<span class="jill"></span>4k<span class="jill"></span>还在缓存中没有被读走</span></li></ul><h4 id="eYT2uS6EqJtAjNtESHFZq8" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>11<span class="jill"></span>步：</span></h4><ul class="wolai-block"><li id="ufxg2Z8HxiNc5gwwuq81aF"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>win4096</code></span><span class="inline-wrap">表示滑动窗口变为<span class="jill"></span>4k，代表还可以接收<span class="jill"></span>4k<span class="jill"></span>数据，还有<span class="jill"></span>2k<span class="jill"></span>在缓存中</span></li></ul><h4 id="cyhZ8qvMuL1g6sNJPN7ZqJ" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>12<span class="jill"></span>步：</span></h4><ul class="wolai-block"><li id="bENuQEVFDhLS2RweBs28HH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">客户端又给服务器发送了<span class="jill"></span>1k<span class="jill"></span>数据</span></li></ul><h4 id="7GssAYLPh8x4L1pD5rWxYE" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>13<span class="jill"></span>步: </span></h4><ul class="wolai-block"><li id="2xaAHvuUZmqYJT2xA5XVYr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">第一次挥手，FIN<span class="jill"></span>表示客户端主动和服务器断开连接，并且发送了<span class="jill"></span>1k<span class="jill"></span>数据到服务器端</span></li></ul><h4 id="oemsEpLS5TGWrx6b58z4AY" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>14<span class="jill"></span>步: </span></h4><ul class="wolai-block"><li id="mPaMZzxpwGQps5LWcdZh4t"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">第二次挥手，回复<span class="jill"></span>ACK, 同意断开连接</span></li></ul><h4 id="hszmEg3xAbj3EhY7YRkkgE" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>15, 16<span class="jill"></span>步: </span></h4><ul class="wolai-block"><li id="iUKz9kQfUK5L5EEHQ987rB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">服务器端从读缓冲区中读数据, 第<span class="jill"></span>16<span class="jill"></span>步数据读完, 滑动窗口变成最大的<span class="jill"></span>6k</span></li></ul><h4 id="4Z1i4GzJUpVzyAJvtpBvL" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>17<span class="jill"></span>步:</span></h4><ul class="wolai-block"><li id="7hbdFPeJGKdcDL1GuP3kap"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>FIN</code></span><span class="inline-wrap">: 服务器请求和客户端断开连接</span></li><li id="dvCpN1g65oq5bd3LWKXHXM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>8001(0)</code></span><span class="inline-wrap">: 服务器一共给客户端发送的字节数 8001 - 8000 = 1<span class="jill"></span>个字节，携带的数据量为<span class="jill"></span>0（FIN<span class="jill"></span>不计算在内）</span></li><li id="hzwiEwfMTny1mdcqNFQkTP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ack8194</code></span><span class="inline-wrap">: 服务器收到了客户端的多少个字节: 8194 - 0 = 8194<span class="jill"></span>个字节</span></li></ul><h4 id="b9EBFFzXAESCSwtU9yfjiS" class="wolai-block"><span class="inline-wrap">第<span class="jill"></span>18<span class="jill"></span>步: 第四次挥手</span></h4><ul class="wolai-block"><li id="wm94LGiM4pzHtd9bXhWMLJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ACK</code></span><span class="inline-wrap">: 客户端同意了服务器断开连接的请求</span></li><li id="if4k6BUqbTwTQFhhsV6Vqh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>8002</code></span><span class="inline-wrap">: 确认序号, 可以计算出服务器给客户端发送了多少数据，8002 - 8000 = 2 个字节</span></li></ul><div id="4QfNeT8nFJ2dMpryBv8sHK" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="pnpsnhDcjQtL3RczuJUkCL" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="bQ8Tqn6EgnV3SxrgovHtTh" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="voQYy7XTVB5JJHNCpwGBxt" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="p28xrn6bYj1a95ZVk4sqA" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></article><footer></footer></body></html></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/wdn_icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Dongnian</div><div class="author-info__description">A salty fish swimming in the sea of deep learning!</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">87</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wdndev"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wdndev" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:dongnian.wang@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/wdnshadow" target="_blank" title="CSDN"><i class="fas fa-rss" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Welcome to My Personal Blog! <br /> If Not, Please Visit <a target="_blank" rel="noopener" href="https://wdndev.gitee.io/"> <font color=#00BFFF>Gitee Mirror</font></a>.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#dE2MbyXLghC9FXbRKk8Cuo"><span class="toc-text">1.TCP协议介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8ocryETJuHfLNWD6LkH12K"><span class="toc-text">2.三次握手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#oaGkVpA8eQSrFJMwGZJDwm"><span class="toc-text">（1）第一次握手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wKPoqVHEuivuCY2PfSTXGv"><span class="toc-text">（2）第二次握手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aU2ioHBiTkyi1e8E16y83e"><span class="toc-text">（3）第三次握手：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gS9a1bkUNEg2YMXQ4ZPjMW"><span class="toc-text">3.四次挥手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3TpLzAP311g3UwLzsu2C8Y"><span class="toc-text">（1）第一次挥手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ejABhzjp9J1qq17yCGKXnA"><span class="toc-text">（2）第二次挥手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rMZ2FHypBi6Zuun44PjEde"><span class="toc-text">（3）第三次挥手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#qtCVpnkVFw6LqFGaWXSSsJ"><span class="toc-text">（4）第四次挥手</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x37MonjXpArJgpwNiXdNM6"><span class="toc-text">4.流量控制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5tPkFyCt41SqBHaBAR1HdN"><span class="toc-text">5.整体流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6Am9iLpDh6hNLA2YSp7sQi"><span class="toc-text">第1步：第一次握手，发送连接请求SYN到服务器端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ab8sGLTkLuTU3ABS5rUeZf"><span class="toc-text">第2步：第二次握手</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pE6ez4LFLVJbbKPpxYduwa"><span class="toc-text">第3步: 第三次握手</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#j4H1Egbweagt3S6QL4HhDF"><span class="toc-text">第4~9步: 客户端给服务器发送数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rdAjhZiYi5sWpDTTzfp8Wv"><span class="toc-text">第10步:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#eYT2uS6EqJtAjNtESHFZq8"><span class="toc-text">第11步：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cyhZ8qvMuL1g6sNJPN7ZqJ"><span class="toc-text">第12步：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7GssAYLPh8x4L1pD5rWxYE"><span class="toc-text">第13步: </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#oemsEpLS5TGWrx6b58z4AY"><span class="toc-text">第14步: </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hszmEg3xAbj3EhY7YRkkgE"><span class="toc-text">第15, 16步: </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4Z1i4GzJUpVzyAJvtpBvL"><span class="toc-text">第17步:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b9EBFFzXAESCSwtU9yfjiS"><span class="toc-text">第18步: 第四次挥手</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/llms/llms_article/9.%E6%A3%80%E7%B4%A2%E5%A2%9E%E5%BC%BALLM/" title="检索增强LLM">检索增强LLM</a><time datetime="2024-01-12T16:00:00.000Z" title="Created 2024-01-13 00:00:00">2024-01-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/llms/llms_course/6.%E6%96%87%E6%9C%AC%E7%90%86%E8%A7%A3%E5%92%8C%E7%94%9F%E6%88%90%E5%A4%A7%E6%A8%A1%E5%9E%8B/" title="LLMs公开课 - 6.文本理解和生成大模型">LLMs公开课 - 6.文本理解和生成大模型</a><time datetime="2024-01-09T16:00:00.000Z" title="Created 2024-01-10 00:00:00">2024-01-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/llms/llms_course/5.%E9%AB%98%E6%95%88%E8%AE%AD%E7%BB%83_%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9/" title="LLMs公开课 - 5.高效训练&amp;模型压缩">LLMs公开课 - 5.高效训练&amp;模型压缩</a><time datetime="2024-01-06T16:00:00.000Z" title="Created 2024-01-07 00:00:00">2024-01-07</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            <a class="card-more-btn" href="/categories/" title="More">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Cython/"><span class="card-category-list-name">Cython</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/DSA/"><span class="card-category-list-name">DSA</span><span class="card-category-list-count">24</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/LLMs/"><span class="card-category-list-name">LLMs</span><span class="card-category-list-count">16</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/PL/"><span class="card-category-list-name">PL</span><span class="card-category-list-count">7</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/PL/Cython/"><span class="card-category-list-name">Cython</span><span class="card-category-list-count">6</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/DSA/" style="font-size: 1.42em; color: rgb(91, 145, 17)">DSA</a><a href="/tags/RL/" style="font-size: 1.28em; color: rgb(176, 79, 19)">RL</a><a href="/tags/Transformer/" style="font-size: 1.45em; color: rgb(127, 170, 70)">Transformer</a><a href="/tags/LLMs/" style="font-size: 1.32em; color: rgb(112, 148, 55)">LLMs</a><a href="/tags/PaperReading/" style="font-size: 1.38em; color: rgb(110, 146, 60)">PaperReading</a><a href="/tags/DeepLearning/" style="font-size: 1.25em; color: rgb(90, 48, 1)">DeepLearning</a><a href="/tags/CV/" style="font-size: 1.15em; color: rgb(82, 200, 174)">CV</a><a href="/tags/GPT/" style="font-size: 1.18em; color: rgb(7, 16, 91)">GPT</a><a href="/tags/PL/" style="font-size: 1.22em; color: rgb(17, 30, 26)">PL</a><a href="/tags/leetcode/" style="font-size: 1.35em; color: rgb(106, 126, 145)">leetcode</a><a href="/tags/algo/" style="font-size: 1.15em; color: rgb(181, 144, 151)">algo</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">January 2024</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">December 2023</span><span class="card-archive-list-count">14</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">November 2023</span><span class="card-archive-list-count">26</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">October 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">September 2023</span><span class="card-archive-list-count">4</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">87</div></div><div class="webinfo-item"><div class="item-name">Run time :</div><div class="item-count" id="runtimeshow" data-publishDate="2023-05-31T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Total Count :</div><div class="item-count">411.2k</div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-12-08T03:57:10.055Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Dongnian</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">簡</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'oe7vzWxH80qwJJjWslYTCViT-gzGzoHsz',
      appKey: 'k89nSbK0BTbmzmpQottRHvNI',
      avatar: 'monsterid',
      serverURLs: 'https://oe7vzwxh.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async src="/js/title.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":180,"height":360,"hOffset":0,"vOffset":-100},"mobile":{"show":true},"react":{"opacity":0.85},"log":false});</script></body></html>