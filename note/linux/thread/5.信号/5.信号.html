<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>37.2° Blog | 37.2° Blog</title><meta name="author" content="Dongnian"><meta name="copyright" content="Dongnian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="5.信号 - wolai 笔记1.信号概述Linux中的信号是一种消息处理机制, 它本质上是一个整数，不同的信号对应不同的值，由于信号的结构简单所以天生不能携带很大的信息量，但是信号在系统中的优先级是非常高的。在Linux中的很多常规操作中都会有相关的信号产生，先从我们最熟悉的场景说起：通过键盘操作产生了信号：用户按下Ctrl-C，这个键盘输入产生一个硬件中断，使用这个快捷键会产生信号, 这个信">
<meta property="og:type" content="website">
<meta property="og:title" content="37.2° Blog">
<meta property="og:url" content="https://wdndev.github.io/note/linux/thread/5.%E4%BF%A1%E5%8F%B7/5.%E4%BF%A1%E5%8F%B7.html">
<meta property="og:site_name" content="37.2° Blog">
<meta property="og:description" content="5.信号 - wolai 笔记1.信号概述Linux中的信号是一种消息处理机制, 它本质上是一个整数，不同的信号对应不同的值，由于信号的结构简单所以天生不能携带很大的信息量，但是信号在系统中的优先级是非常高的。在Linux中的很多常规操作中都会有相关的信号产生，先从我们最熟悉的场景说起：通过键盘操作产生了信号：用户按下Ctrl-C，这个键盘输入产生一个硬件中断，使用这个快捷键会产生信号, 这个信">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://wdndev.github.io/img/wdn_icon.png">
<meta property="article:published_time" content="2024-12-08T03:56:27.886Z">
<meta property="article:modified_time" content="2024-12-08T03:56:27.886Z">
<meta property="article:author" content="Dongnian">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wdndev.github.io/img/wdn_icon.png"><link rel="shortcut icon" href="/img/wdn_icon.png"><link rel="canonical" href="https://wdndev.github.io/note/linux/thread/5.%E4%BF%A1%E5%8F%B7/5.%E4%BF%A1%E5%8F%B7.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":100,"languages":{"author":"Author: Dongnian","link":"Link: ","source":"Source: 37.2° Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '37.2° Blog',
  isPost: false,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-08 11:56:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/wdn_icon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">87</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Content</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/paper_reading/pr_content"><i class="fa-fw fas fa-newspaper"></i><span> Paper</span></a></li><li><a class="site-page child" href="/llms/llms_idx"><i class="fa-fw fa-solid fa-magnifying-glass"></i><span> LLMs</span></a></li><li><a class="site-page child" href="/jupyter"><i class="fa-fw fa-solid fa-file"></i><span> Jupyter</span></a></li><li><a class="site-page child" href="/note"><i class="fa-fw fa-regular fa-bookmark"></i><span> Note</span></a></li><li><a class="site-page child" href="/dsa/dsa_idx"><i class="fa-fw fas fa-tree"></i><span> Algorithm</span></a></li><li><a class="site-page child" href="/program_language/pl_idx"><i class="fa-fw fas fa-code"></i><span> PLs</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="37.2° Blog"><span class="site-name">37.2° Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Content</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/paper_reading/pr_content"><i class="fa-fw fas fa-newspaper"></i><span> Paper</span></a></li><li><a class="site-page child" href="/llms/llms_idx"><i class="fa-fw fa-solid fa-magnifying-glass"></i><span> LLMs</span></a></li><li><a class="site-page child" href="/jupyter"><i class="fa-fw fa-solid fa-file"></i><span> Jupyter</span></a></li><li><a class="site-page child" href="/note"><i class="fa-fw fa-regular fa-bookmark"></i><span> Note</span></a></li><li><a class="site-page child" href="/dsa/dsa_idx"><i class="fa-fw fas fa-tree"></i><span> Algorithm</span></a></li><li><a class="site-page child" href="/program_language/pl_idx"><i class="fa-fw fas fa-code"></i><span> PLs</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="page"><h1 class="page-title"></h1><div id="article-container"><!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../css/wolai.css"/><title>5.信号 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="5.信号" class="main-title"></div></div></header><article><h1 id="ugAGgWBCD2AXu7GfXfrZYD" class="wolai-block"><span class="inline-wrap">1.信号概述</span></h1><div id="vYnbLG5N3QHc71t5Paw2pJ" class="wolai-block wolai-text"><div><span class="inline-wrap">Linux<span class="jill"></span>中的信号是一种消息处理机制, 它本质上是一个整数，不同的信号对应不同的值，由于信号的结构简单所以天生不能携带很大的信息量，但是信号在系统中的优先级是非常高的。</span></div></div><div id="jgGVJLyUhgLcPJzWUP1CRW" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Linux<span class="jill"></span>中的很多常规操作中都会有相关的信号产生，先从我们最熟悉的场景说起：</span></div></div><ul class="wolai-block"><li id="tWeBBDgUFNZrhiP2AnMmmB"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>通过键盘操作产生了信号</b></span><span class="inline-wrap">：用户按下<span class="jill"></span>Ctrl-C，这个键盘输入产生一个硬件中断，使用这个快捷键会产生信号, 这个信号会杀死对应的某个进程</span></li><li id="7J6X5eA8qwukrykGAEkmMx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>通过<span class="jill"></span>shell<span class="jill"></span>命令产生了信号</b></span><span class="inline-wrap">：通过<span class="jill"></span>kill<span class="jill"></span>命令终止某一个进程，</span><span class="inline-wrap"><code>kill -9 进程<span class="jill"></span>PID</code></span></li><li id="jcocu2SyVp71e75WugsV2X"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>通过函数调用产生了信号</b></span><span class="inline-wrap">：如果<span class="jill"></span>CPU<span class="jill"></span>当前正在执行这个进程的代码调用，比如函数 </span><span class="inline-wrap"><code>sleep()</code></span><span class="inline-wrap">，进程收到相关的信号，被迫挂起</span></li><li id="wMPPzjjewHurc2ACwtZrr1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>通过对硬件进行非法访问产生了信号</b></span><span class="inline-wrap">：正在运行的程序访问了非法内存，发生段错误，进程退出。</span></li></ul><div id="rzFrbzog3FFTfG3kzg6Xt2" class="wolai-block wolai-text"><div><span class="inline-wrap">信号也可以实现进程间通信，但是信号能传递的数据量很少，不能满足大部分需求，另外信号的优先级很高，并且它对应的处理动作是回调完成的，它会打乱程序原有的处理流程，影响到最终的处理结果。因此非常不建议使用信号进行进程间通信。</span></div></div><h2 id="hnnjPYn7wetEqRy4wxUnAk" class="wolai-block"><span class="inline-wrap">1.1 信号编号</span></h2><blockquote id="hKM3pJEJfETUjHUdSYseuJ" class="wolai-block"><span class="inline-wrap">通过 </span><span class="inline-wrap"><code>kill -l</code></span><span class="inline-wrap"> 命令可以察看系统定义的信号列表:</span></blockquote><code-block id="spBa8LA9yGkxQKYkcevzCL" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token comment"># 执行shell命令查看信号</span>
$ <span class="token function">kill</span> <span class="token parameter variable">-l</span>
 <span class="token number">1</span><span class="token punctuation">)</span> SIGHUP       <span class="token number">2</span><span class="token punctuation">)</span> SIGINT       <span class="token number">3</span><span class="token punctuation">)</span> SIGQUIT      <span class="token number">4</span><span class="token punctuation">)</span> SIGILL       <span class="token number">5</span><span class="token punctuation">)</span> SIGTRAP
 <span class="token number">6</span><span class="token punctuation">)</span> SIGABRT      <span class="token number">7</span><span class="token punctuation">)</span> SIGBUS       <span class="token number">8</span><span class="token punctuation">)</span> SIGFPE       <span class="token number">9</span><span class="token punctuation">)</span> SIGKILL     <span class="token number">10</span><span class="token punctuation">)</span> SIGUSR1
<span class="token number">11</span><span class="token punctuation">)</span> SIGSEGV     <span class="token number">12</span><span class="token punctuation">)</span> SIGUSR2     <span class="token number">13</span><span class="token punctuation">)</span> SIGPIPE     <span class="token number">14</span><span class="token punctuation">)</span> SIGALRM     <span class="token number">15</span><span class="token punctuation">)</span> SIGTERM
<span class="token number">16</span><span class="token punctuation">)</span> SIGSTKFLT   <span class="token number">17</span><span class="token punctuation">)</span> SIGCHLD     <span class="token number">18</span><span class="token punctuation">)</span> SIGCONT     <span class="token number">19</span><span class="token punctuation">)</span> SIGSTOP     <span class="token number">20</span><span class="token punctuation">)</span> SIGTSTP
<span class="token number">21</span><span class="token punctuation">)</span> SIGTTIN     <span class="token number">22</span><span class="token punctuation">)</span> SIGTTOU     <span class="token number">23</span><span class="token punctuation">)</span> SIGURG      <span class="token number">24</span><span class="token punctuation">)</span> SIGXCPU     <span class="token number">25</span><span class="token punctuation">)</span> SIGXFSZ
<span class="token number">26</span><span class="token punctuation">)</span> SIGVTALRM   <span class="token number">27</span><span class="token punctuation">)</span> SIGPROF     <span class="token number">28</span><span class="token punctuation">)</span> SIGWINCH    <span class="token number">29</span><span class="token punctuation">)</span> SIGIO       <span class="token number">30</span><span class="token punctuation">)</span> SIGPWR
<span class="token number">31</span><span class="token punctuation">)</span> SIGSYS      <span class="token number">34</span><span class="token punctuation">)</span> SIGRTMIN    <span class="token number">35</span><span class="token punctuation">)</span> SIGRTMIN+1  <span class="token number">36</span><span class="token punctuation">)</span> SIGRTMIN+2  <span class="token number">37</span><span class="token punctuation">)</span> SIGRTMIN+3
<span class="token number">38</span><span class="token punctuation">)</span> SIGRTMIN+4  <span class="token number">39</span><span class="token punctuation">)</span> SIGRTMIN+5  <span class="token number">40</span><span class="token punctuation">)</span> SIGRTMIN+6  <span class="token number">41</span><span class="token punctuation">)</span> SIGRTMIN+7  <span class="token number">42</span><span class="token punctuation">)</span> SIGRTMIN+8
<span class="token number">43</span><span class="token punctuation">)</span> SIGRTMIN+9  <span class="token number">44</span><span class="token punctuation">)</span> SIGRTMIN+10 <span class="token number">45</span><span class="token punctuation">)</span> SIGRTMIN+11 <span class="token number">46</span><span class="token punctuation">)</span> SIGRTMIN+12 <span class="token number">47</span><span class="token punctuation">)</span> SIGRTMIN+13
<span class="token number">48</span><span class="token punctuation">)</span> SIGRTMIN+14 <span class="token number">49</span><span class="token punctuation">)</span> SIGRTMIN+15 <span class="token number">50</span><span class="token punctuation">)</span> SIGRTMAX-14 <span class="token number">51</span><span class="token punctuation">)</span> SIGRTMAX-13 <span class="token number">52</span><span class="token punctuation">)</span> SIGRTMAX-12
<span class="token number">53</span><span class="token punctuation">)</span> SIGRTMAX-11 <span class="token number">54</span><span class="token punctuation">)</span> SIGRTMAX-10 <span class="token number">55</span><span class="token punctuation">)</span> SIGRTMAX-9  <span class="token number">56</span><span class="token punctuation">)</span> SIGRTMAX-8  <span class="token number">57</span><span class="token punctuation">)</span> SIGRTMAX-7
<span class="token number">58</span><span class="token punctuation">)</span> SIGRTMAX-6  <span class="token number">59</span><span class="token punctuation">)</span> SIGRTMAX-5  <span class="token number">60</span><span class="token punctuation">)</span> SIGRTMAX-4  <span class="token number">61</span><span class="token punctuation">)</span> SIGRTMAX-3  <span class="token number">62</span><span class="token punctuation">)</span> SIGRTMAX-2
<span class="token number">63</span><span class="token punctuation">)</span> SIGRTMAX-1  <span class="token number">64</span><span class="token punctuation">)</span> SIGRTMAX</pre></div></code-block><div id="wVMdJMWaQ6Nku9bAUQ2GSf" class="wolai-block wolai-text"><div><span class="inline-wrap">下表中详细阐述了信号产生的时机和对应的默认处理动作:</span></div></div><div id="gbsB5JYrpwLSiPfcxEzC61" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 54px"><span class="inline-wrap"><b>编号</b></span></th><th style="width: 105px"><span class="inline-wrap"><b>信号</b></span></th><th style="width: 401px"><span class="inline-wrap"><b>对应事件</b></span></th><th style="width: 241px"><span class="inline-wrap"><b>默认动作</b></span></th></tr></thead><tbody><tr><td><span class="inline-wrap">1</span></td><td><span class="inline-wrap">SIGHUP</span></td><td><span class="inline-wrap">用户退出<span class="jill"></span>shell<span class="jill"></span>时，由该<span class="jill"></span>shell<span class="jill"></span>启动的所有进程将收到这个信号</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">2</span></td><td><span class="inline-wrap">SIGINT</span></td><td><span class="inline-wrap">当用户按下了&lt;Ctrl+C&gt;组合键时，用户终端向正在运行中的由该终端启动的程序发出此信号</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">3</span></td><td><span class="inline-wrap">SIGQUIT</span></td><td><span class="inline-wrap">用户按下&lt;ctrl+\\&gt;组合键时产生该信号，用户终端向正在运行中的由该终端启动的程序发出些信号</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">4</span></td><td><span class="inline-wrap">SIGILL</span></td><td><span class="inline-wrap">CPU<span class="jill"></span>检测到某进程执行了非法指令</span></td><td><span class="inline-wrap">终止进程并产生<span class="jill"></span>core<span class="jill"></span>文件</span></td></tr><tr><td><span class="inline-wrap">5</span></td><td><span class="inline-wrap">SIGTRAP</span></td><td><span class="inline-wrap">该信号由断点指令或其他 trap<span class="jill"></span>指令产生</span></td><td><span class="inline-wrap">终止进程并产生<span class="jill"></span>core<span class="jill"></span>文件</span></td></tr><tr><td><span class="inline-wrap">6</span></td><td><span class="inline-wrap">SIGABRT</span></td><td><span class="inline-wrap">调用<span class="jill"></span>abort<span class="jill"></span>函数时产生该信号</span></td><td><span class="inline-wrap">终止进程并产生<span class="jill"></span>core<span class="jill"></span>文件</span></td></tr><tr><td><span class="inline-wrap">7</span></td><td><span class="inline-wrap">SIGBUS</span></td><td><span class="inline-wrap">非法访问内存地址，包括内存对齐出错</span></td><td><span class="inline-wrap">终止进程并产生<span class="jill"></span>core<span class="jill"></span>文件</span></td></tr><tr><td><span class="inline-wrap">8</span></td><td><span class="inline-wrap">SIGFPE</span></td><td><span class="inline-wrap">在发生致命的运算错误时发出。不仅包括浮点运算错误，还包括溢出及除数为<span class="jill"></span>0<span class="jill"></span>等所有的算法错误</span></td><td><span class="inline-wrap">终止进程并产生<span class="jill"></span>core<span class="jill"></span>文件</span></td></tr><tr><td><span class="inline-wrap">9</span></td><td><span class="inline-wrap">SIGKILL</span></td><td><span class="inline-wrap">无条件终止进程。本信号不能被忽略，处理和阻塞</span></td><td><span class="inline-wrap">终止进程，可以杀死任何进程</span></td></tr><tr><td><span class="inline-wrap">10</span></td><td><span class="inline-wrap">SIGUSE1</span></td><td><span class="inline-wrap">用户定义的信号。即程序员可以在程序中定义并使用该信号</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">11</span></td><td><span class="inline-wrap">SIGSEGV</span></td><td><span class="inline-wrap">指示进程进行了无效内存访问(段错误)</span></td><td><span class="inline-wrap">终止进程并产生<span class="jill"></span>core<span class="jill"></span>文件</span></td></tr><tr><td><span class="inline-wrap">12</span></td><td><span class="inline-wrap">SIGUSR2</span></td><td><span class="inline-wrap">另外一个用户自定义信号，程序员可以在程序中定义并使用该信号</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">13</span></td><td><span class="inline-wrap">SIGPIPE</span></td><td><span class="inline-wrap">Broken pipe<span class="jill"></span>向一个没有读端的管道写数据</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">14</span></td><td><span class="inline-wrap">SIGALRM</span></td><td><span class="inline-wrap">定时器超时，超时的时间 由系统调用<span class="jill"></span>alarm<span class="jill"></span>设置</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">15</span></td><td><span class="inline-wrap">SIGTERM</span></td><td><span class="inline-wrap">程序结束信号，与<span class="jill"></span>SIGKILL<span class="jill"></span>不同的是，该信号可以被阻塞和终止。通常用来要示程序正常退出。执行<span class="jill"></span>shell<span class="jill"></span>命令<span class="jill"></span>Kill<span class="jill"></span>时，缺省产生这个信号</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">16</span></td><td><span class="inline-wrap">SIGSTKFLT</span></td><td><span class="inline-wrap">Linux<span class="jill"></span>早期版本出现的信号，现仍保留向后兼容</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">17</span></td><td><span class="inline-wrap">SIGCHLD</span></td><td><span class="inline-wrap">子进程结束时，父进程会收到这个信号</span></td><td><span class="inline-wrap">忽略这个信号</span></td></tr><tr><td><span class="inline-wrap">18</span></td><td><span class="inline-wrap">SIGCONT</span></td><td><span class="inline-wrap">如果进程已停止，则使其继续运行</span></td><td><span class="inline-wrap">继续/忽略</span></td></tr><tr><td><span class="inline-wrap">19</span></td><td><span class="inline-wrap">SIGSTOP</span></td><td><span class="inline-wrap">停止进程的执行。信号不能被忽略，处理和阻塞</span></td><td><span class="inline-wrap">为终止进程</span></td></tr><tr><td><span class="inline-wrap">20</span></td><td><span class="inline-wrap">SIGTSTP</span></td><td><span class="inline-wrap">停止终端交互进程的运行。按下&lt;ctrl+z&gt;组合键时发出这个信号</span></td><td><span class="inline-wrap">暂停进程</span></td></tr><tr><td><span class="inline-wrap">21</span></td><td><span class="inline-wrap">SIGTTIN</span></td><td><span class="inline-wrap">后台进程读终端控制台</span></td><td><span class="inline-wrap">暂停进程</span></td></tr><tr><td><span class="inline-wrap">22</span></td><td><span class="inline-wrap">SIGTTOU</span></td><td><span class="inline-wrap">该信号类似于<span class="jill"></span>SIGTTIN，在后台进程要向终端输出数据时发生</span></td><td><span class="inline-wrap">暂停进程</span></td></tr><tr><td><span class="inline-wrap">23</span></td><td><span class="inline-wrap">SIGURG</span></td><td><span class="inline-wrap">套接字上有紧急数据时，向当前正在运行的进程发出些信号，报告有紧急数据到达。如网络带外数据到达</span></td><td><span class="inline-wrap">忽略该信号</span></td></tr><tr><td><span class="inline-wrap">24</span></td><td><span class="inline-wrap">SIGXCPU</span></td><td><span class="inline-wrap">进程执行时间超过了分配给该进程的<span class="jill"></span>CPU<span class="jill"></span>时间 ，系统产生该信号并发送给该进程</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">25</span></td><td><span class="inline-wrap">SIGXFSZ</span></td><td><span class="inline-wrap">超过文件的最大长度设置</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">26</span></td><td><span class="inline-wrap">SIGVTALRM</span></td><td><span class="inline-wrap">虚拟时钟超时时产生该信号。类似于<span class="jill"></span>SIGALRM，但是该信号只计算该进程占用<span class="jill"></span>CPU<span class="jill"></span>的使用时间</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">27</span></td><td><span class="inline-wrap">SGIPROF</span></td><td><span class="inline-wrap">类似于<span class="jill"></span>SIGVTALRM，它不公包括该进程占用<span class="jill"></span>CPU<span class="jill"></span>时间还包括执行系统调用时间</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">28</span></td><td><span class="inline-wrap">SIGWINCH</span></td><td><span class="inline-wrap">窗口变化大小时发出</span></td><td><span class="inline-wrap">忽略该信号</span></td></tr><tr><td><span class="inline-wrap">29</span></td><td><span class="inline-wrap">SIGIO</span></td><td><span class="inline-wrap">此信号向进程指示发出了一个异步<span class="jill"></span>IO<span class="jill"></span>事件</span></td><td><span class="inline-wrap">忽略该信号</span></td></tr><tr><td><span class="inline-wrap">30</span></td><td><span class="inline-wrap">SIGPWR</span></td><td><span class="inline-wrap">关机</span></td><td><span class="inline-wrap">终止进程</span></td></tr><tr><td><span class="inline-wrap">31</span></td><td><span class="inline-wrap">SIGSYS</span></td><td><span class="inline-wrap">无效的系统调用</span></td><td><span class="inline-wrap">终止进程并产生<span class="jill"></span>core<span class="jill"></span>文件</span></td></tr><tr><td><span class="inline-wrap">34~64</span></td><td><span class="inline-wrap">SIGRTMIN ～ SIGRTMAX</span></td><td><span class="inline-wrap">LINUX<span class="jill"></span>的实时信号，它们没有固定的含义（可以由用户自定义）</span></td><td><span class="inline-wrap">终止进程</span></td></tr></tbody></table></div><h2 id="9rpWcyYfNiAaTjR9kL9Sj5" class="wolai-block"><span class="inline-wrap">1.2 查看信号信息</span></h2><div id="p9dLkZdSJ6QZgTz9haT4u7" class="wolai-block wolai-text"><div><span class="inline-wrap">通过<span class="jill"></span>Linux<span class="jill"></span>提供的 man 文档可以查询所有信号的详细信息:</span></div></div><code-block id="pZc3WY1huRARmcywbYgsmf" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token comment"># 查看man文档的信号描述</span>
$ <span class="token function">man</span> <span class="token number">7</span> signal</pre></div></code-block><div id="mAvKHhUP2zBPoukQvaDd4o" class="wolai-block wolai-text"><div><span class="inline-wrap">在信号描述中介绍了对产生的信号的五种默认处理动作，分别是：</span></div></div><ol class="wolai-block"><li id="bmk95kfGd1xdotLMWAP2ge"><div class="marker"></div><span class="inline-wrap"><code>Term</code></span><span class="inline-wrap">：信号将进程终止</span></li><li id="u29iSJ5evwmE3q3nvBDjzV"><div class="marker"></div><span class="inline-wrap"><code>Ign</code></span><span class="inline-wrap">：信号产生之后默认被忽略了</span></li><li id="gYpFsee2bt1yeJScGGs2p4"><div class="marker"></div><span class="inline-wrap"><code>Core</code></span><span class="inline-wrap">：信号将进程终止, 并且生成一个<span class="jill"></span>core<span class="jill"></span>文件(一般用于<span class="jill"></span>gdb<span class="jill"></span>调试)</span></li><li id="9aZ1jyZbYL3Liggqa5gfD5"><div class="marker"></div><span class="inline-wrap"><code>Stop</code></span><span class="inline-wrap">：信号会暂停进程的运行</span></li><li id="tKLKwDsPpjXEa2aGNn7z6y"><div class="marker"></div><span class="inline-wrap"><code>Cont</code></span><span class="inline-wrap">：信号会让暂停的进程继续运行</span></li></ol><div id="jVn2umKHeScE7JeAXe383f" class="wolai-block wolai-text"><div><span class="inline-wrap">关于对信号的介绍有一句非常重要的描述:</span></div></div><div id="3Z9a6WjK6tZDTGE4M7Dnkt" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>The signals SIGKILL and SIGSTOP cannot be caught, blocked, or ignored.</code></span></div></div><div id="sqvR9JxF8NHyQh6VMezFPz" class="wolai-block wolai-text"><div><span class="red inline-wrap"><code>9<span class="jill"></span>号信号和<span class="jill"></span>19<span class="jill"></span>号信号不能被 捕捉, 阻塞, 和 忽略</code></span></div></div><ul class="wolai-block"><li id="BEXXfRFRNStSwiKs3Sgai"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>9<span class="jill"></span>号信号: 无条件杀死进程</code></span></li><li id="42FZXL7bS8YktbPgsCk8Xv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>19<span class="jill"></span>号信号: 无条件暂停进程</code></span></li></ul><div id="6UNTd1Y8WFvZnarg2XQEef" class="wolai-block wolai-text"><div><span class="inline-wrap">有些信号在不同的平台对应的值是不一样的，对应我们使用<span class="jill"></span>PC<span class="jill"></span>机来说，需要看中间一列的值：</span></div></div><div id="9rrauG3sfewe1h4ZArMzh7" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://subingwen.cn/linux/signal/image-20200425164709088.png" style="width: 525.3333333333334px"/></figure></div><h2 id="iHkHHfcF3G2VKxfitoJzBW" class="wolai-block"><span class="inline-wrap">1.3 信号的状态</span></h2><div id="iLejA4Cygztx4cU9BLtVLu" class="wolai-block wolai-text"><div><span class="inline-wrap">Linux<span class="jill"></span>中的信号有三种状态，分别为：产生，未决，递达。</span></div></div><ol class="wolai-block"><li id="ceNPZuSYsbiyURvm2AmutV"><div class="marker"></div><span class="inline-wrap"><code>产生</code></span><span class="inline-wrap">：键盘输入, 函数调用, 执行<span class="jill"></span>shell<span class="jill"></span>命令, 对硬件进行非法访问都会产生信号</span></li><li id="ne47DSduepTA2mQuBrartQ"><div class="marker"></div><span class="inline-wrap"><code>未决</code></span><span class="inline-wrap">：信号产生了, 但是这个信号还没有被处理掉, 这个期间信号的状态称之为未决状态</span></li><li id="bX7gGuY99MyQrHiiWT5dNF"><div class="marker"></div><span class="inline-wrap"><code>递达</code></span><span class="inline-wrap">：信号被处理了(被某个进程处理掉)</span></li></ol><div id="tj7XqHroA5VwGRQWoyT7z7" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://subingwen.cn/linux/signal/image-20210206135036666.png" style="width: 1383.3333333333333px"/></figure></div><h1 id="dQnbWmPRc8uKWBBUS5VBwz" class="wolai-block"><span class="inline-wrap">2.信号相关函数</span></h1><div id="m6N79CHtkacsrF8aJg3cdp" class="wolai-block wolai-text"><div><span class="inline-wrap">Linux<span class="jill"></span>中能够产生信号的函数有很多，下面介绍几个常用函数：</span></div></div><h2 id="jz85xNSPnfe6rLBD6w6Ce5" class="wolai-block"><span class="inline-wrap">2.1 kill/raise/abort</span></h2><div id="u9Az7eMXqKBP7xhya6kJfk" class="wolai-block wolai-text"><div><span class="inline-wrap">这三个函数的功能比较类似，可以发送相关的信号给到对应的进程。</span></div></div><h3 id="oEGjFwTqfkxLZDwkgMNW3P" class="wolai-block"><span class="inline-wrap">（1）kill</span></h3><div id="8Ssk6875vUNDoqFDEDgDiG" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>kill </code></span><span class="inline-wrap">发送指定的信号到指定的进程，函数原型如下：</span></div></div><code-block id="mgi3j357Ja2ziCHWnSJA2f" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>
<span class="token comment">// 给某一个进程发送一个信号</span>
<span class="token keyword">int</span> <span class="token function">kill</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> pid<span class="token punctuation">,</span> <span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><ul class="wolai-block"><li id="7vt69ByjkeddTkJRHDZeb4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">参数:</span><ul class="wolai-block"><li id="5wErv862aG5zX44yUT68Dm"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>pid</code></span><span class="inline-wrap">: 进程<span class="jill"></span>ID（man 文档里边写的比较详细）</span></li><li id="3VPs4m9ppLvFyqGyLGfGVD"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>sig</code></span><span class="inline-wrap">: 要发送的信号</span></li></ul></li></ul><div id="iyGJaqut9JuDUufJ6H4MSn" class="wolai-block wolai-text"><div><span class="inline-wrap">函数使用举例:</span></div></div><code-block id="2GUppj1EKwq6HX2nzVmKNk" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">// 自己杀死自己</span>
<span class="token function">kill</span><span class="token punctuation">(</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 子进程杀死自己的父进程</span>
<span class="token function">kill</span><span class="token punctuation">(</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><h3 id="vsKd6oje6GWxQS6fdJQdXd" class="wolai-block"><span class="inline-wrap">（2）raise</span></h3><div id="rAt2Gcq3ReNj8m6JDuL5WL" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>raise</code></span><span class="inline-wrap">：给当前进程发送指定的信号，函数原型如下：</span></div></div><code-block id="5cPrGscZa1zPEuFYeuCP13" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">// 给自己发送某一个信号</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>
<span class="token keyword">int</span> <span class="token function">raise</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 参数就是要给当前进程发送的信号</span></pre></div></code-block><h3 id="2QPadXzGP35Jgw6aEwyoVa" class="wolai-block"><span class="inline-wrap">（3）abort</span></h3><div id="vfk8u4CwBNcEKekLLVjrJp" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>abort</code></span><span class="inline-wrap">：给当前进程发送一个固定信号 (SIGABRT)，函数原型如下：</span></div></div><code-block id="ujrNVB4CgBQMkZViUMgFym" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">// 这是一个中断函数, 调用这个函数, 发送一个固定信号 (SIGABRT), 杀死当前进程</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token keyword">void</span> <span class="token function">abort</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><h2 id="eAufALvzPQmqs5H9uzG1on" class="wolai-block"><span class="inline-wrap">2.2 定时器</span></h2><h3 id="iaEgq5rYFtKXeJnBzWq5rQ" class="wolai-block"><span class="inline-wrap">（1） alarm</span></h3><div id="4NAPaex7iDM6N7uc5FUdJZ" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>alarm()</code></span><span class="inline-wrap"> 函数只能进行单次定时，定时完成发射出一个信号。</span></div></div><code-block id="eFZawhS82EtUkG6e6z5Wb6" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> seconds<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><ul class="wolai-block"><li id="vfd11e4TtYViJWz4qhQUZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>参数</b></span><span class="inline-wrap">: 倒计时<span class="jill"></span>seconds<span class="jill"></span>秒, 倒计时完成发送一个信号 </span><span class="inline-wrap"><code>SIGALRM </code></span><span class="inline-wrap">, 当前进程会收到这个信号，这个信号默认的处理动作是中断当前进程</span></li><li id="fi7tD66tJXgX2un17hHRUQ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>返回值</b></span><span class="inline-wrap">: 大于<span class="jill"></span>0<span class="jill"></span>表示倒计时还剩多少秒，返回值为<span class="jill"></span>0<span class="jill"></span>表示倒计时完成, 信号被发出</span></li></ul><blockquote id="fKsfYD3MPy7CevpoKU97aQ" class="wolai-block"><span class="inline-wrap">使用这个定时器函数, 检测一下当前计算机<span class="jill"></span>1s<span class="jill"></span>钟之内能数多少个数</span></blockquote><code-block id="pyN6LHfbY3bzdtkZW3UGEc" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// 1. 设置一个定时器, 定时1s</span>
    <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1s之后会发出一个信号, 这个信号将中断当前进程</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="tWGSFGR52TQsW9ojgsjiiF" class="wolai-block wolai-text"><div><span class="inline-wrap">执行上述程序的时候, 计算一下时间</span></div></div><code-block id="eCZGgqR2mB8ECKzCnsWFi1" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token comment"># 直接通过终端输出</span>
$ <span class="token function">time</span> ./a.out
real    0m1.013s    <span class="token comment"># 实际数数用的总时间</span>
user    0m0.060s    <span class="token comment"># 用户区代码使用的时间</span>
sys     0m0.324s    <span class="token comment"># 内核区使用的时间</span>

real <span class="token operator">=</span> user + sys + 消耗的时间<span class="token punctuation">(</span>频率的从用户区到内核区进程切换<span class="token punctuation">)</span>

<span class="token comment"># 不直接写终端, 将数据重定向到磁盘文件中</span>
$ <span class="token function">time</span> ./a.out <span class="token operator">></span> a.txt
Alarm clock

real    0m1.002s    <span class="token comment"># 用户实际数数的时间变长了</span>
user    0m0.740s
sys     0m0.236s</pre></div></code-block><div id="f37rEzH8ye7Qy1gvF2P2Df" class="wolai-block wolai-text"><div><span class="inline-wrap">文件<span class="jill"></span>IO<span class="jill"></span>操作需要进行用户区到内核区的切换，处理方式不同，二者之间切换的频率也不同。也就是说对文件<span class="jill"></span>IO<span class="jill"></span>操作进行优化是可以提供程序的执行效率的。</span></div></div><h3 id="i47QMaV5qJn84q4wF21pYt" class="wolai-block"><span class="inline-wrap">（2）setitimer</span></h3><div id="cvDfFWd8zKJB3zNnRxjC32" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>setitimer()</code></span><span class="inline-wrap"> 函数可以进行周期性定时，每触发一次定时器就会发射出一个信号。</span></div></div><code-block id="iijABvmRBiRTfntU1WWnrB" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token comment">// 这个函数可以实现周期性定时, 每个一段固定的时间, 发出一个特定的定时器信号</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>

<span class="token keyword">struct</span> <span class="token class-name">itimerval</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">struct</span> <span class="token class-name">timeval</span> it_interval<span class="token punctuation">;</span> <span class="token comment">/* 时间间隔 */</span>
  <span class="token keyword">struct</span> <span class="token class-name">timeval</span> it_value<span class="token punctuation">;</span>    <span class="token comment">/* 第一次触发定时器的时长 */</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 举例: luffy有一个闹钟, 并且使用这个闹钟定时:</span>
<span class="token comment">// 早晨7点中起床, 第一次闹钟响起时可能起不来, 之后每隔5分钟再响一次</span>
<span class="token comment">//  - it_value: 当前设置闹钟的时间点 到 明天早晨7点 对应的总秒数</span>
<span class="token comment">//  - it_interval: 闹钟第一次响过之后, 每隔5分钟响一次</span>

<span class="token comment">// 这个结构体表示的是一个时间段: tv_sec + tv_usec</span>
<span class="token keyword">struct</span> <span class="token class-name">timeval</span> <span class="token punctuation">&#123;</span>
  <span class="token class-name">time_t</span>      tv_sec<span class="token punctuation">;</span>         <span class="token comment">/* 秒 */</span>
  <span class="token class-name">suseconds_t</span> tv_usec<span class="token punctuation">;</span>        <span class="token comment">/* 微妙 */</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">setitimer</span><span class="token punctuation">(</span><span class="token keyword">int</span> which<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">itimerval</span> <span class="token operator">*</span>new_value<span class="token punctuation">,</span> 
              <span class="token keyword">struct</span> <span class="token class-name">itimerval</span> <span class="token operator">*</span>old_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="aY4KZnoNqx4sUpibVsjhAo" class="wolai-block wolai-text"><div><span class="inline-wrap">参数:</span></div></div><ul class="wolai-block"><li id="56ZYwWB1mKVommtdh5AAdE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>which</code></span><span class="inline-wrap">: 定时器使用什么样的计时法则, 不同的计时法则发出的信号不同</span><ul class="wolai-block"><li id="7ntn7mAtnoj6V9359HCnGH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ITIMER_REAL</code></span><span class="inline-wrap">: 自然计时法, 最常用, 发出的信号为</span><span class="inline-wrap"><code>SIGALRM</code></span><span class="inline-wrap">, 一般使用这个宏值，自然计时法时间 = 用户区 + 内核 + 消耗的时间(从进程的用户区到内核区切换使用的总时间)</span></li><li id="5X6N24eQw4hLEfnAtLE2cU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ITIMER_VIRTUAL</code></span><span class="inline-wrap">: 只计算程序在用户区运行使用的时间，发射的信号为 </span><span class="inline-wrap"><code>SIGVTALRM</code></span></li><li id="qY1L982jwL4XAdBEoMLHjR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>ITIMER_PROF</code></span><span class="inline-wrap">: 只计算内核运行使用的时间, 发出的信号为</span><span class="inline-wrap"><code>SIGPROF</code></span></li></ul></li><li id="pGMvGBBdUJFVZJs7xWmUv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>new_value</code></span><span class="inline-wrap">: 给定时器设置的定时信息, 传入参数</span></li><li id="sh9xGLfmQ4rXM9L9gBuUBy"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>old_value</code></span><span class="inline-wrap">: 上一次给定时器设置的定时信息, 传出参数，如果不需要这个信息, 指定为<span class="jill"></span>NULL</span></li></ul><h1 id="82GENFyTJbNrcJjUNTGNCn" class="wolai-block"><span class="inline-wrap">3.信号集</span></h1><h2 id="5kNohXYWv9eggUVKoCR9jv" class="wolai-block"><span class="inline-wrap">3.1 阻塞/未决信号集</span></h2><div id="ncTyqe1TyStbeuyHAniRT3" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>PCB<span class="jill"></span>中有两个非常重要的信号集。一个称之为“</span><span class="inline-wrap"><code>阻塞信号集</code></span><span class="inline-wrap">”，另一个称之为“</span><span class="inline-wrap"><code>未决信号集</code></span><span class="inline-wrap">”。这两个信号集体现在内核中就是两张表。但是</span><span class="yellow inline-wrap"><b>操作系统不允许我们直接对这两个信号集进行任何操作，而是需要自定义另外一个集合，借助信号集操作函数来对<span class="jill"></span>PCB<span class="jill"></span>中的这两个信号集进行修改。</b></span></div></div><ul class="wolai-block"><li id="iGe8V9R383cyqD6F9Z967T" class="red"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>信号的 “未决” 是一种状态，指的是从信号的产生到信号被处理前的这一段时间。</b></span></li><li id="cW6cN9LUCbwQZB3Q68HV9n" class="red"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><b>信号的 “阻塞” 是一个开关动作，指的是阻止信号被处理，但不是阻止信号产生。</b></span></li></ul><div id="7do2mo2HwYAayshacnLu6m" class="wolai-block wolai-text"><div><span class="yellow inline-wrap"><b>信号的阻塞就是让系统暂时保留信号留待以后发送。</b></span><span class="inline-wrap">由于另外有办法让系统忽略信号，所以一般情况下信号的阻塞只是暂时的，只是为了 防止信号打断某些敏感的操作。</span></div></div><div id="7kSCLY96CEchoootV3ETyU" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://subingwen.cn/linux/signal/image-20210206135824272.png" style="width: 624.6666666666666px"/></figure></div><div id="uSfnfSBqYXjudqqoFhSDXW" class="wolai-block wolai-text"><div><span class="inline-wrap">阻塞信号集和未决信号集在内核中的结构是相同的，它们都是一个整形数组(被封装过的), 一共 128 字节 （</span><span class="inline-wrap"><code>int [32] == 1024 bit</code></span><span class="inline-wrap">），1024<span class="jill"></span>个标志位，其中前<span class="jill"></span>31<span class="jill"></span>个标志位，每一个都对应一个<span class="jill"></span>Linux<span class="jill"></span>中的标准信号，通过标志位的值来标记当前信号在信号集中的状态。</span></div></div><code-block id="dGuicntkpjcZkEXq3EWH5E" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token comment"># 上图对信号集在内核中存储的状态的描述</span>
<span class="token comment"># 前31个信号: 1-31 , 对应 1024个标志位的前31个标志位</span>
      信号    标志位<span class="token punctuation">(</span>从低地址位 到 高地址位<span class="token punctuation">)</span>
         <span class="token number">1</span>      -<span class="token operator">></span>    <span class="token number">0</span>
        <span class="token number">2</span>             <span class="token number">1</span>
        <span class="token number">3</span>             <span class="token number">2</span>
        <span class="token number">4</span>             <span class="token number">3</span>
       <span class="token number">31</span>            <span class="token number">30</span>  </pre></div></code-block><div id="t74htKzsdcHvB1m8SMwmwc" class="wolai-block wolai-text"><div><span class="inline-wrap">在</span><span class="yellow inline-wrap"><b>阻塞信号集</b></span><span class="inline-wrap">中，描述这个信号有没有被阻塞</span></div></div><ul class="wolai-block"><li id="g5mjcQF5oVYtoiGjALpw3J"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">默认情况下没有信号是被阻塞的, 因此信号对应的标志位的值为 0</span></li><li id="qKXNshTU7zgYH5g7d9qWve"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果某个信号被设置为了阻塞状态, 这个信号对应的标志位 被设置为 1</span></li></ul><div id="LfZXfYmNw6UrMR8RJo9EV" class="wolai-block wolai-text"><div><span class="inline-wrap">在</span><span class="yellow inline-wrap"><b>未决信号集</b></span><span class="inline-wrap">中, 描述信号是否处于未决状态</span></div></div><ul class="wolai-block"><li id="pjwuhvowyNwNb5zpVW9Crq"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果这个信号被阻塞了, 不能处理, 这个信号对应的标志位被设置为<span class="jill"></span>1</span></li><li id="nvqsM8ZRThPoeTtin8oxFz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果这个信号的阻塞被解除了, 未决信号集中的这个信号马上就被处理了, 这个信号对应的标志位值变为<span class="jill"></span>0</span></li><li id="3VYtMVsC5GzWtiuaxZpyeU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">如果这个信号没有阻塞, 信号产生之后直接被处理, 因此不会在未决信号集中做任何记录</span></li></ul><h2 id="gUUUHNEqrjoQJThWBgguqk" class="wolai-block"><span class="inline-wrap">3.2 信号集函数</span></h2><div id="m6cZ735idsj8oKLvnYNis" class="wolai-block wolai-text"><div><span class="inline-wrap">因为用户是不能直接操作内核中的阻塞信号集和未决信号集的，必须要调用系统函数，关于阻塞信号集可以通过系统函数进行读写操作，未决信号集只能对其进行读操作。</span></div></div><div id="vqyqmdvib4Hm8PF2zHJQRX" class="wolai-block wolai-text"><div><span class="inline-wrap">先来看一下读/写阻塞信号集的函数：</span></div></div><code-block id="EV3WE2D4Q56Q3oB1WNrLD" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>
<span class="token comment">// 使用这个函数修改内核中的阻塞信号集</span>
<span class="token comment">// sigset_t 被封装之后得到的数据类型, 原型:int[32], 里边一共有1024给标志位, 每一个信号对应一个标志位</span>
<span class="token keyword">int</span> <span class="token function">sigprocmask</span><span class="token punctuation">(</span><span class="token keyword">int</span> how<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>oldset<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="o1EQenKgfM2KNq1PVR5EAE" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>参数</b></span><span class="inline-wrap">:</span></div></div><ul class="wolai-block"><li id="t3LH7mNJDVbHKFEVX7cDZY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>how</code></span><span class="inline-wrap">:</span><ul class="wolai-block"><li id="oP9HSFEXzSofsBfYQhRSHS"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>SIG_BLOCK</code></span><span class="inline-wrap">: 将参数 set 集合中的数据追加到阻塞信号集中</span></li><li id="9BVBoaWNMpNpYjnPc1QTao"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>SIG_UNBLOCK</code></span><span class="inline-wrap">: 将参数 set 集合中的信号在阻塞信号集中解除阻塞</span></li><li id="9Dz1vtbsmeJ8LBkL4Vrx6A"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>SIG_SETMASK</code></span><span class="inline-wrap">: 使用参 set 结合中的数据覆盖内核的阻塞信号集数据</span></li></ul></li><li id="bJH1TdPX28euejEj53nCb"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">oldset: 通过这个参数将设置之前的阻塞信号集数据传出，如果不需要可以指定为<span class="jill"></span>NULL</span></li></ul><div id="wSC1es92e2MAkenzni7j92" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>返回值</b></span><span class="inline-wrap">：函数调用成功返回<span class="jill"></span>0，调用失败返回-1</span></div></div><div id="iQnyZw7MF8RGnZNJELxgRJ" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>sigprocmask() </code></span><span class="inline-wrap">函数有一个 </span><span class="inline-wrap"><code>sigset_t </code></span><span class="inline-wrap">类型的参数，对这种类型的数据进行初始化需要调用一些相关的操作函数：</span></div></div><code-block id="dCijY6RzFyKkPjSqSPaeMS" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>
<span class="token comment">// 如果在程序中读写 sigset_t 类型的变量</span>
<span class="token comment">// 阻塞信号集和未决信号集都存储在 sigset_t 类型的变量中, 这个变量对应一块内存</span>
<span class="token comment">// 阻塞信号集和未决信号集, 对应的内存中有1024bit = 128字节</span>

<span class="token comment">// 将set集合中所有的标志位设置为0</span>
<span class="token keyword">int</span> <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将set集合中所有的标志位设置为1</span>
<span class="token keyword">int</span> <span class="token function">sigfillset</span><span class="token punctuation">(</span><span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将set集合中某一个信号(signum)对应的标志位设置为1</span>
<span class="token keyword">int</span> <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将set集合中某一个信号(signum)对应的标志位设置为0</span>
<span class="token keyword">int</span> <span class="token function">sigdelset</span><span class="token punctuation">(</span><span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 判断某个信号在集合中对应的标志位到底是0还是1, 如果是0返回0, 如果是1返回1</span>
<span class="token keyword">int</span> <span class="token function">sigismember</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">,</span> <span class="token keyword">int</span> signum<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="oTCckqZMfAPyBcLRWv5TS6" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://subingwen.cn/linux/signal/image-20210206142122901.png" style="width: 1036px"/></figure></div><div id="vZdsweXvKfFUFVpUH1RR6c" class="wolai-block wolai-text"><div><span class="inline-wrap">未决信号集不需要程序猿修改, 如果设置了某个信号阻塞, 当这个信号产生之后, 内核会将这个信号的未决状态记录到未决信号集中，当阻塞的信号被解除阻塞, 未决信号集中的信号随之被处理, 内核再次修改未决信号集将该信号的状态修改为递达状态（标志位置<span class="jill"></span>0）。因此，写未决信号集的动作都是内核做的，这是一个读未决信号集的操作函数：</span></div></div><code-block id="n9UnGGakjrdCYDFQBUHZcS" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>
<span class="token comment">// 这个函数的参数是传出参数, 传出的内核未决信号集的拷贝</span>
<span class="token comment">// 读一下这个集合就指定哪个信号是未决状态</span>
<span class="token keyword">int</span> <span class="token function">sigpending</span><span class="token punctuation">(</span><span class="token class-name">sigset_t</span> <span class="token operator">*</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="tyXsjWwaQRfHwKuA1XqEo9" class="wolai-block wolai-text"><div><span class="inline-wrap">下面举一个简单的例子，演示一下信号集操作函数的使用：</span></div></div><code-block id="apshK7iYVoLJhKjRzxZL2Q" class="wolai-block"><div class="wolai-pre"><div data-lang="Text" class="marker"></div><pre>需求: 
在阻塞信号集中设置某些信号阻塞, 通过一些操作产生这些信号, 然后读未决信号集, 最后再解除这些信号的阻塞
假设阻塞这些信号: 
  - 2号信号: SIGINT: ctrl+c
  - 3号信号: SIGQUIT: ctrl+\
  - 9号信号: SIGKILL: 通过shell命令给进程发送这个信号 kill -9 PID</pre></div></code-block><code-block id="cHw9snd7veV21XQqtMCCjc" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// 1. 初始化信号集</span>
    <span class="token class-name">sigset_t</span> myset<span class="token punctuation">;</span>
    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置阻塞的信号</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> SIGINT<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> SIGQUIT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> SIGKILL<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9 测试不能被阻塞</span>

    <span class="token comment">// 2. 将初始化的信号集中的数据设置给内核</span>
    <span class="token class-name">sigset_t</span> old<span class="token punctuation">;</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> <span class="token operator">&amp;</span>old<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. 让进程一直运行, 在当前进程中产生对应的信号</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">// 4. 读内核的未决信号集</span>
        <span class="token class-name">sigset_t</span> curset<span class="token punctuation">;</span>
        <span class="token function">sigpending</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 遍历这个信号集</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">32</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">sigismember</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curset<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token comment">// 解除阻塞, 重新设置阻塞信号集</span>
            <span class="token comment">//sigprocmask(SIG_UNBLOCK, &amp;myset, NULL);</span>
            <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>old<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="jyx6uRBuBUE2wkQmtc6oGK" class="wolai-block wolai-text"><div><span class="inline-wrap">通过测试最终得到结论：</span><span class="red inline-wrap">程序中对 9 号信号的阻塞是无效的，因为它无法被阻塞。</span></div></div><div id="4xsYmBJAQbEjDmvJGg4WnS" class="wolai-block wolai-text"><div><span class="inline-wrap">最后通过一张图总结一下这些信号集操作函数之间的关系:</span></div></div><div id="uBdoow56PiEcaptwJoDAB9" class="wolai-block"><figure class="wolai-center" style="width: 100%"><img src="https://subingwen.cn/linux/signal/image-20210206181522522.png" style="width: 1586px"/></figure></div><h1 id="pBU6GePw41o9sUH3iNVTWp" class="wolai-block"><span class="inline-wrap">4.信号捕捉</span></h1><div id="qWCD3JeSJu9bEbT21k78nt" class="wolai-block wolai-text"><div><span class="inline-wrap">Linux<span class="jill"></span>中的每个信号产生之后都会有对应的默认处理行为，如果想要忽略这个信号或者修改某些信号的默认行为就需要在程序中捕捉该信号。程序中进行信号捕捉可以看做是一个注册的动作，提前告诉应用程序信号产生之后做什么样的处理，当进程中对应的信号产生了，这个处理动作也就被调用了。</span></div></div><h2 id="kWpDyMcaEXU6LLVFWJkgur" class="wolai-block"><span class="inline-wrap">4.1 signal</span></h2><div id="R7tg4Zxd1iVsAuqxBCLHy" class="wolai-block wolai-text"><div><span class="inline-wrap">使用 </span><span class="inline-wrap"><code>signal() </code></span><span class="inline-wrap">函数可以</span><span class="red inline-wrap">捕捉进程中产生的信号，并且修改捕捉到的函数的行为</span><span class="inline-wrap">，这个信号的自定义处理动作是一个回调函数，内核通过 </span><span class="inline-wrap"><code>signal()</code></span><span class="inline-wrap"> 得到这个回调函数的地址，在信号产生之后该函数会被内核调用。</span></div></div><code-block id="kSd1oPm5tREQMgVaE1mtxy" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>
<span class="token comment">// 在程序中什么时候产生信号, 程序猿是不知道的, 因此不能在信号产生之后再去处理</span>
<span class="token comment">// 在信号产生之前, 提供一个注册函数, 用来捕捉信号</span>
<span class="token comment">//    - 假设在将来这个信号产生了, 就委托内核进行捕捉, 这个信号的默认动作就不能被执行</span>
<span class="token comment">//    - 执行什么样的处理动作 ==> 在signal函数中指定的处理动作</span>
<span class="token comment">//    - 如果这个信号不产生, 回调函数永远不会被调用</span>
<span class="token class-name">sighandler_t</span> <span class="token function">signal</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> <span class="token class-name">sighandler_t</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>   
</pre></div></code-block><ul class="wolai-block"><li id="pXLgQYhHyiMN5afAE3nZHu"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">参数:</span><ul class="wolai-block"><li id="2MooiqfcgSGrJNG91YroG2"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>signum</code></span><span class="inline-wrap">: 需要捕捉的信号</span></li><li id="2nCwMwR218Shsgz6vXMMUj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>handler</code></span><span class="inline-wrap">: 信号捕捉到之后的处理动作, 这是一个函数指针, 函数原型</span><code-block id="4nz28Dv1vu1fmVDxRX1hh4" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token class-name">sighandler_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div id="f6yp4fwrg6KMayD3WUR2iY" class="wolai-block wolai-text"><div><span class="red inline-wrap">这个回调函数是需要程序猿写的, 但是程序猿不调用, 由内核调用，内核调用回调函数的时候, 会给它传递一个实参，这个实参的值就是捕捉的那个信号值。</span></div></div></li></ul></li></ul><div id="vThV5p1iMZmcH6dneqMcnx" class="wolai-block wolai-text"><div><span class="inline-wrap">下面的测试程序中使用 </span><span class="inline-wrap"><code>signal() </code></span><span class="inline-wrap">函数来捕捉定时器产生的信号 </span><span class="inline-wrap"><code>SIGALRM</code></span><span class="inline-wrap">：</span></div></div><code-block id="c5byNVXEyp5z3gJx8Yqwtf" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>

<span class="token comment">// 定时器信号的处理动作</span>
<span class="token keyword">void</span> <span class="token function">doing</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当前捕捉到的信号是: %d\n"</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印当前的时间</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// 注册要捕捉哪一个信号, 执行什么样的处理动作</span>
    <span class="token function">signal</span><span class="token punctuation">(</span>SIGALRM<span class="token punctuation">,</span> doing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1. 调用定时器函数设置定时器函数</span>
    <span class="token keyword">struct</span> <span class="token class-name">itimerval</span> newact<span class="token punctuation">;</span>
    <span class="token comment">// 3s之后发出第一个定时器信号, 之后每隔1s发出一个定时器信号</span>
    newact<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    newact<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    newact<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    newact<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// 这个函数也不是阻塞函数, 函数调用成功, 倒计时开始</span>
    <span class="token comment">// 倒计时过程中程序是继续运行的</span>
    <span class="token function">setitimer</span><span class="token punctuation">(</span>ITIMER_REAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>newact<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 编写一个业务处理, 阻止当前进程自己结束, 让当前进程被发出的信号杀死</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><h2 id="nXWXRfz4A1cG56sSkmiAo7" class="wolai-block"><span class="inline-wrap">4.2 sigaction</span></h2><div id="owv2ZeHQygoaCPwdcHgCJd" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>sigaction() </code></span><span class="inline-wrap">函数和 </span><span class="inline-wrap"><code>signal() </code></span><span class="inline-wrap">函数的功能是一样的，用于</span><span class="red inline-wrap">捕捉进程中产生的信号，并将用户自定义的信号行为函数（回调函数）注册给内核，内核在信号产生之后调用这个处理动作</span><span class="inline-wrap">。</span><span class="inline-wrap"><code>sigaction()</code></span><span class="inline-wrap"> 可以看做是 </span><span class="inline-wrap"><code>signal()</code></span><span class="inline-wrap"> 函数是加强版，函数参数更多更复杂，函数功能也更强一些。函数原型如下：</span></div></div><code-block id="hv1TpG2JPv1J17ByyMtmMP" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>
<span class="token keyword">int</span> <span class="token function">sigaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>act<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token operator">*</span>oldact<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><ul class="wolai-block"><li id="cano9qZw9sfL76RzRFBiWV"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">参数:</span><ul class="wolai-block"><li id="bU4EsFvv5rizQQucHPsAH8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>signum</code></span><span class="inline-wrap">: 要捕捉的信号</span></li><li id="jPSBw4CnahkqXXVCXXFNUT"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>act</code></span><span class="inline-wrap">: 捕捉到信号之后的处理动作</span></li><li id="5PPt9s2bGAkLKpQqPRkyr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>oldact</code></span><span class="inline-wrap">: 上一次调用该函数进行信号捕捉设置的信号处理动作, 该参数一般指定为<span class="jill"></span>NULL</span></li></ul></li><li id="6cZUFwkyCu3zLcVXxWopED"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">返回值：函数调用成功返回<span class="jill"></span>0，失败返回-1</span></li></ul><div id="tJqEqFTZa6yRt1QkRq5U41" class="wolai-block wolai-text"><div><span class="inline-wrap">该函数的参数是一个结构体类型，结构体原型如下：</span></div></div><code-block id="eNc3dgTmvMiqSoJzuNJv2S" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">void</span>     <span class="token punctuation">(</span><span class="token operator">*</span>sa_handler<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 指向一个函数(回调函数)</span>
  <span class="token keyword">void</span>     <span class="token punctuation">(</span><span class="token operator">*</span>sa_sigaction<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">siginfo_t</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">sigset_t</span>   sa_mask<span class="token punctuation">;</span>             <span class="token comment">// 初始化为空即可, 处理函数执行期间不屏蔽任何信号</span>
  <span class="token keyword">int</span>        sa_flags<span class="token punctuation">;</span>          <span class="token comment">// 0</span>
  <span class="token keyword">void</span>     <span class="token punctuation">(</span><span class="token operator">*</span>sa_restorer<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//不用</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
</pre></div></code-block><div id="6sMxXLY3zuTSGpn3JPwPRo" class="wolai-block wolai-text"><div><span class="inline-wrap">结构体成员介绍：</span></div></div><ul class="wolai-block"><li id="nartzJqnhCipMPLSNkfjAm"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>sa_handler</code></span><span class="inline-wrap">: 函数指针，指向的函数就是捕捉到的信号的处理动作</span></li><li id="46LxWSPvU3QeebE3quz8q6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>sa_sigaction</code></span><span class="inline-wrap">: 函数指针，指向的函数就是捕捉到的信号的处理动作</span></li><li id="nHkBdfFYN9qN6He4hGH41m"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>sa_mask</code></span><span class="inline-wrap">: </span><span class="red inline-wrap">在信号处理函数执行期间, 临时屏蔽某些信号</span><span class="inline-wrap">, 将要屏蔽的信号设置到集合中即可</span><ul class="wolai-block"><li id="pnvmuu9XTrPecw4WpPstNR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">当前处理函数执行完毕, 临时屏蔽自动解除</span></li><li id="s1ExY4Gbs7QW7t62dNqXow"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">假设在这个集合中不屏蔽任何信号, 默认也会屏蔽一个（捕捉的信号是谁, 就临时屏蔽谁）</span></li></ul></li><li id="5PkGxwAA8GmCs7N3cGdRiT"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>sa_flags</code></span><span class="inline-wrap">：使用哪个函数指针指向的函数处理捕捉到的信号</span><ul class="wolai-block"><li id="ng2mCqyk8x9jpTnTgQS8nj"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>0</code></span><span class="inline-wrap">：使用 </span><span class="inline-wrap"><code>sa_handler</code></span><span class="inline-wrap"> (一般情况下使用这个)</span></li><li id="hzdAc1dkavAYSbR7AvRrGb"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>SA_SIGINFO</code></span><span class="inline-wrap">：使用 sa_sigaction (使用信号传递数据==进程间通信)</span></li></ul></li><li id="mAKnLD2i7sF52CEzi888Dw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><code>sa_restorer</code></span><span class="inline-wrap">: 被废弃的成员</span></li></ul><div id="afp7py4jdaGtYnNBsrqZzH" class="wolai-block wolai-text"><div><span class="inline-wrap">示例代码，通过</span><span class="inline-wrap"><code>sigaction()</code></span><span class="inline-wrap">捕捉阻塞信号集中解除阻塞的信号，如果捕捉多个信号，可以给不同的信号添加不同的处理动作，代码中的处理动作只有一个：</span></div></div><code-block id="scfvATZVFyGo4cBA4G7oNy" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>

<span class="token comment">// 信号的处理动作</span>
<span class="token keyword">void</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当前捕捉的信号: %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// 1. 初始化信号集</span>
    <span class="token class-name">sigset_t</span> myset<span class="token punctuation">;</span>
    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置阻塞的信号</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> SIGINT<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> SIGQUIT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> SIGKILL<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9 测试不能被阻塞</span>

    <span class="token comment">// 当阻塞的信号被解除阻塞, 该信号就可以被捕捉到了</span>
    <span class="token comment">// 如果信号被捕捉到之后, 马上就被处理掉了 --> 递达状态</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> act<span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 和sigint的处理动作相同</span>
    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGQUIT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGKILL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. 将初始化的信号集中的数据设置给内核</span>
    <span class="token class-name">sigset_t</span> old<span class="token punctuation">;</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> <span class="token operator">&amp;</span>old<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. 让进程一直运行, 在当前进程中产生对应的信号</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">// 4. 读内核的未决信号集</span>
        <span class="token class-name">sigset_t</span> curset<span class="token punctuation">;</span>
        <span class="token function">sigpending</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 遍历这个信号集</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">32</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">sigismember</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>curset<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token comment">// 解除阻塞, 重新设置阻塞信号集</span>
            <span class="token comment">//sigprocmask(SIG_UNBLOCK, &amp;myset, NULL);</span>
            <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>old<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</pre></div></code-block><div id="t21b6g8Hy73J1XEUTov8Lf" class="wolai-block wolai-text"><div><span class="inline-wrap">通过测试最终得到结论：</span><span class="red inline-wrap">程序中对 9 号信号的捕捉是无效的，因为它无法被捕捉。</span></div></div><h1 id="thhRxvrQguBaeVHR31C1Ng" class="wolai-block"><span class="inline-wrap">5.SIGCHLD<span class="jill"></span>信号</span></h1><div id="dmhgp7DktwDW7eoCAjDzAN" class="wolai-block wolai-text"><div><span class="inline-wrap">当子进程退出、暂停、从暂停回复运行的时候，在子进程中会产生一个</span><span class="inline-wrap"><code>SIGCHLD</code></span><span class="inline-wrap">信号，并将其发送给父进程，但是父进程收到这个信号之后默认就忽略了。我们可以在父进程中对这个信号加以利用，基于这个信号来回收子进程的资源，因此需要在父进程中捕捉子进程发送过来的这个信号。</span></div></div><div id="8e5anXsoJdbBkGWPCwW6bB" class="wolai-block wolai-text"><div><span class="inline-wrap">下面是基于信号回收子进程资源的示例代码：</span></div></div><code-block id="56Khq9UJJZYqTGgAyFkwB4" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span>

<span class="token comment">// 回收子进程处理函数</span>
<span class="token keyword">void</span> <span class="token function">recycle</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"捕捉到的信号是: %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 子进程的资源回收, 非阻塞</span>
    <span class="token comment">// SIGCHLD信号17号信号, 1-31号信号不支持排队</span>
    <span class="token comment">// 如果这些信号同时产生多个, 最终处理的时候只处理一次</span>
    <span class="token comment">// 假设多个子进程同时退出, 父进程同时收到了多个sigchld信号</span>
    <span class="token comment">// 父进程只会处理一次这个信号, 因此当前函数被调用了一次, waitpid被调用一次</span>
    <span class="token comment">// 相当于只回收了一个子进程, 但是是同时死了多个子进程, 因此就出现了僵尸进程</span>
    <span class="token comment">// 解决方案: 循环回收即可</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 如果是阻塞回收, 就回不到另外一个处理逻辑上去了</span>
        <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">waitpid</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> WNOHANG<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"child died, pid = %d\n"</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// 没有死亡的子进程, 直接退出当前循环</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"所有子进程都回收完毕了, 拜拜...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 设置sigchld信号阻塞</span>
    <span class="token class-name">sigset_t</span> myset<span class="token punctuation">;</span>
    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> SIGCHLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 循环创建多个子进程 - 20</span>
    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"我是子进程, pid = %d\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"我是父进程, pid = %d\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注册信号捕捉, 捕捉sigchld</span>
        <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> act<span class="token punctuation">;</span>
        act<span class="token punctuation">.</span>sa_flags  <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        act<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> recycle<span class="token punctuation">;</span>
        <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注册信号捕捉, 委托内核处理将来产生的信号</span>
        <span class="token comment">// 当信号产生之后, 当前进程优先处理信号, 之前的处理动作会暂停</span>
        <span class="token comment">// 信号处理完毕之后, 回到原来的暂停的位置继续运行</span>
        <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGCHLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 解除sigcld信号的阻塞</span>
        <span class="token comment">// 信号被阻塞之后,就捕捉不到了, 解除阻塞之后才能捕捉到这个信号</span>
        <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_UNBLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myset<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 父进程执行其他业务逻辑就可以了</span>
        <span class="token comment">// 默认父进程执行这个while循环, 但是信号产生了, 这个执行逻辑或强迫暂停</span>
        <span class="token comment">//   父进程去处理信号的处理函数</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div></code-block></article><footer></footer></body></html></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/wdn_icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Dongnian</div><div class="author-info__description">A salty fish swimming in the sea of deep learning!</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">87</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wdndev"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wdndev" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:dongnian.wang@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/wdnshadow" target="_blank" title="CSDN"><i class="fas fa-rss" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Welcome to My Personal Blog! <br /> If Not, Please Visit <a target="_blank" rel="noopener" href="https://wdndev.gitee.io/"> <font color=#00BFFF>Gitee Mirror</font></a>.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ugAGgWBCD2AXu7GfXfrZYD"><span class="toc-text">1.信号概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hnnjPYn7wetEqRy4wxUnAk"><span class="toc-text">1.1 信号编号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9rpWcyYfNiAaTjR9kL9Sj5"><span class="toc-text">1.2 查看信号信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iHkHHfcF3G2VKxfitoJzBW"><span class="toc-text">1.3 信号的状态</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dQnbWmPRc8uKWBBUS5VBwz"><span class="toc-text">2.信号相关函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#jz85xNSPnfe6rLBD6w6Ce5"><span class="toc-text">2.1 kill&#x2F;raise&#x2F;abort</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#oEGjFwTqfkxLZDwkgMNW3P"><span class="toc-text">（1）kill</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vsKd6oje6GWxQS6fdJQdXd"><span class="toc-text">（2）raise</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2QPadXzGP35Jgw6aEwyoVa"><span class="toc-text">（3）abort</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eAufALvzPQmqs5H9uzG1on"><span class="toc-text">2.2 定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#iaEgq5rYFtKXeJnBzWq5rQ"><span class="toc-text">（1） alarm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#i47QMaV5qJn84q4wF21pYt"><span class="toc-text">（2）setitimer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#82GENFyTJbNrcJjUNTGNCn"><span class="toc-text">3.信号集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5kNohXYWv9eggUVKoCR9jv"><span class="toc-text">3.1 阻塞&#x2F;未决信号集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gUUUHNEqrjoQJThWBgguqk"><span class="toc-text">3.2 信号集函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pBU6GePw41o9sUH3iNVTWp"><span class="toc-text">4.信号捕捉</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#kWpDyMcaEXU6LLVFWJkgur"><span class="toc-text">4.1 signal</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nXWXRfz4A1cG56sSkmiAo7"><span class="toc-text">4.2 sigaction</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#thhRxvrQguBaeVHR31C1Ng"><span class="toc-text">5.SIGCHLD信号</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/llms/llms_article/9.%E6%A3%80%E7%B4%A2%E5%A2%9E%E5%BC%BALLM/" title="检索增强LLM">检索增强LLM</a><time datetime="2024-01-12T16:00:00.000Z" title="Created 2024-01-13 00:00:00">2024-01-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/llms/llms_course/6.%E6%96%87%E6%9C%AC%E7%90%86%E8%A7%A3%E5%92%8C%E7%94%9F%E6%88%90%E5%A4%A7%E6%A8%A1%E5%9E%8B/" title="LLMs公开课 - 6.文本理解和生成大模型">LLMs公开课 - 6.文本理解和生成大模型</a><time datetime="2024-01-09T16:00:00.000Z" title="Created 2024-01-10 00:00:00">2024-01-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/llms/llms_course/5.%E9%AB%98%E6%95%88%E8%AE%AD%E7%BB%83_%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9/" title="LLMs公开课 - 5.高效训练&amp;模型压缩">LLMs公开课 - 5.高效训练&amp;模型压缩</a><time datetime="2024-01-06T16:00:00.000Z" title="Created 2024-01-07 00:00:00">2024-01-07</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            <a class="card-more-btn" href="/categories/" title="More">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Cython/"><span class="card-category-list-name">Cython</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/DSA/"><span class="card-category-list-name">DSA</span><span class="card-category-list-count">24</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/LLMs/"><span class="card-category-list-name">LLMs</span><span class="card-category-list-count">16</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/PL/"><span class="card-category-list-name">PL</span><span class="card-category-list-count">7</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/PL/Cython/"><span class="card-category-list-name">Cython</span><span class="card-category-list-count">6</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/DSA/" style="font-size: 1.42em; color: rgb(91, 145, 17)">DSA</a><a href="/tags/RL/" style="font-size: 1.28em; color: rgb(176, 79, 19)">RL</a><a href="/tags/Transformer/" style="font-size: 1.45em; color: rgb(127, 170, 70)">Transformer</a><a href="/tags/LLMs/" style="font-size: 1.32em; color: rgb(112, 148, 55)">LLMs</a><a href="/tags/PaperReading/" style="font-size: 1.38em; color: rgb(110, 146, 60)">PaperReading</a><a href="/tags/DeepLearning/" style="font-size: 1.25em; color: rgb(90, 48, 1)">DeepLearning</a><a href="/tags/CV/" style="font-size: 1.15em; color: rgb(82, 200, 174)">CV</a><a href="/tags/GPT/" style="font-size: 1.18em; color: rgb(7, 16, 91)">GPT</a><a href="/tags/PL/" style="font-size: 1.22em; color: rgb(17, 30, 26)">PL</a><a href="/tags/leetcode/" style="font-size: 1.35em; color: rgb(106, 126, 145)">leetcode</a><a href="/tags/algo/" style="font-size: 1.15em; color: rgb(181, 144, 151)">algo</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">January 2024</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">December 2023</span><span class="card-archive-list-count">14</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">November 2023</span><span class="card-archive-list-count">26</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">October 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">September 2023</span><span class="card-archive-list-count">4</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">87</div></div><div class="webinfo-item"><div class="item-name">Run time :</div><div class="item-count" id="runtimeshow" data-publishDate="2023-05-31T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Total Count :</div><div class="item-count">411.2k</div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-12-08T03:57:10.055Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Dongnian</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">簡</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'oe7vzWxH80qwJJjWslYTCViT-gzGzoHsz',
      appKey: 'k89nSbK0BTbmzmpQottRHvNI',
      avatar: 'monsterid',
      serverURLs: 'https://oe7vzwxh.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async src="/js/title.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":180,"height":360,"hOffset":0,"vOffset":-100},"mobile":{"show":true},"react":{"opacity":0.85},"log":false});</script></body></html>